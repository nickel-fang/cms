webpackJsonp([8],{"3RuF":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n,r,d=E(a("vgHw")),i=E(a("vaID")),o=E(a("yF52")),u=E(a("0b0c")),c=E(a("IidI")),s=E(a("G3dI")),p=E(a("uuhB")),f=E(a("Dd8w")),m=E(a("Zx67")),g=E(a("Zrlr")),h=E(a("wxAW")),v=E(a("zwoO")),y=E(a("Pf15")),I=E(a("37+n"));a("ZJow"),a("nclB"),a("tNTX"),a("kxBb"),a("1uA9"),a("/Hhv"),a("TZP0"),a("8QNH");var S=a("GiK3"),b=E(S),C=a("Mn8c"),w=(a("F8kA"),a("y986"));function E(e){return e&&e.__esModule?e:{default:e}}var k=I.default.Item,T=(0,C.inject)("category")(l=(0,C.observer)((n=function(e){function t(e){(0,g.default)(this,t);var a=(0,v.default)(this,(t.__proto__||(0,m.default)(t)).call(this,e));r.call(a);var l=a.props,n=l.value,d=void 0===n?{}:n,i=l.category.curCatg,o=l.type;return a.state={templateId:d.templateId||null,pageTemplateId:d.pageTemplateId||null,templateName:"",visible:!1},"detail"==o?a.state.templateName=i.template?i.template.name:"":(o="category")&&(a.state.templateName=i.pageTemplate?i.pageTemplate.name:""),a}return(0,y.default)(t,e),(0,h.default)(t,[{key:"componentWillReceiveProps",value:function(e){if(e.value){var t=e.value,a=t.templateId||null,l=t.pageTemplateId||null;this.setState({templateId:a,pageTemplateId:l})}this.needchange||this.getTemplateName()}},{key:"triggerChange",value:function(e){var t=this.props.type,a=this.props.onChange;a&&("detail"==t?a((0,f.default)({templateId:this.state.templateId},e)):"category"==t&&a((0,f.default)({pageTemplateId:this.state.pageTemplateId},e)))}},{key:"render",value:function(){var e=this.props,t=e.category,a=(t.curCatg,t.templateDataSource),l=t.templatePagination,n=t.loading,r=(t.query,e.type,e.form.getFieldDecorator),m=this.state,g=m.visible,h=m.templateName,v={title:"",visible:g,width:"80%",footer:null,onCancel:this.hide.bind(this)},y=(0,w.toJS)(l),S=(0,w.toJS)(a);return b.default.createElement("div",{className:"template-select"},b.default.createElement(i.default,v,b.default.createElement(I.default,{style:{marginBottom:"20px"}},b.default.createElement(u.default,null,b.default.createElement(s.default,{span:8},b.default.createElement(k,(0,f.default)({label:"模板名称"},{labelCol:{span:6},wrapperCol:{span:18}}),r("name",{initialValue:""})(b.default.createElement(p.default,null)))),b.default.createElement(s.default,{span:4,style:{marginLeft:"20px",marginTop:"4px"}},b.default.createElement(c.default,{type:"primary",onClick:this.onSearch},"查询")))),b.default.createElement(o.default,{simple:!0,size:"middle",columns:this.getColumns(),dataSource:S,pagination:y,onChange:this.onPageChange,loading:n,rowKey:function(e){return e.id}})),h?b.default.createElement("span",{className:"template-name"},h,b.default.createElement(d.default,{className:"template-delete",type:"close",onClick:this.onDelete})):null,b.default.createElement(c.default,{onClick:this.show},"选择模版"))}}]),t}(S.Component),r=function(){var e=this;this.getTemplateName=function(){var t=e.props,a=t.type,l=t.category.curCatg;"category"==a?e.setState({templateName:l.pageTemplate?l.pageTemplate.name:""}):"detail"==a&&e.setState({templateName:l.template?l.template.name:""})},this.getColumns=function(){return[{title:"模版名称",dataIndex:"name",width:100},{title:"模版描述",dataIndex:"description",width:100},{title:"操作",width:100,className:"action",render:function(t,a){a.id,a.name;return[b.default.createElement("a",{key:"action-1",onClick:e.onSelect.bind(e,a),style:{marginRight:"5px"}},"选择")]}}]},this.onSelect=function(t){var a=e.props,l=(a.category.templateDataSource,a.type);e.needchange=!0,e.setState({visible:!1,templateName:t.name}),"detail"==l?e.triggerChange({templateId:t.id}):"category"==l&&e.triggerChange({pageTemplateId:t.id})},this.hide=function(){var t=e.props.form.resetFields;e.setState({visible:!1}),t()},this.show=function(){var t=e.props;(0,t.category.getTemplateList)({siteId:t.siteId}),e.setState({visible:!0})},this.onDelete=function(){var t=e.props.type;e.needchange=!0,e.setState({templateName:""}),"detail"==t?e.triggerChange({templateId:null}):"category"==t&&e.triggerChange({pageTemplateId:null})},this.onPageChange=function(t){var a=e.props,l=a.category,n=l.getTemplateList,r=l.query,d=a.siteId;n((0,f.default)({},r,{pageNumber:t.current,pageSize:t.pageSize,siteId:d}))},this.onSearch=function(t){var a=e.props,l=a.form.getFieldsValue,n=a.category,r=n.query,d=n.updateStore,i=n.getTempByName,o=l(),u=(0,w.toJS)(r);for(var c in o=(0,f.default)({},u,o))o[c]||delete o[c];o.pageNumber="1",d({query:r}),i(o)}},l=n))||l)||l;t.default=I.default.create()(T)},"R/+9":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n,r,d=x(a("1cZb")),i=x(a("IidI")),o=x(a("uuhB")),u=x(a("Dd8w")),c=x(a("kr0b")),s=x(a("Zx67")),p=x(a("Zrlr")),f=x(a("wxAW")),m=x(a("zwoO")),g=x(a("Pf15")),h=x(a("37+n")),v=x(a("NJOH")),y=x(a("09Ma")),I=x(a("hIkJ"));a("YaoS"),a("1uA9"),a("TZP0"),a("2xSi"),a("8QNH"),a("mKHw"),a("c686");var S=a("GiK3"),b=x(S),C=a("Mn8c"),w=a("y986"),E=a("F8kA"),k=a("SFkB"),T=x(a("mw3O")),N=x(a("3RuF"));function x(e){return e&&e.__esModule?e:{default:e}}var _=y.default.TreeNode,J=(v.default.Option,h.default.Item),R={labelCol:{span:4},wrapperCol:{span:9}},F=(0,C.inject)("app")(l=(0,C.inject)("category")(l=(0,C.observer)((n=function(e){function t(e){(0,p.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e));r.call(a);var l=e.history,n=e.location.search,d=e.category,i=(e.app.selectSiteId,T.default.parse(n.substr(1))),o={};return(0,w.toJS)(d.dataSource).length||l.push("/category"),d.getBlogTree(),i.id?d.getCatgItem(i.id):i.parentId&&(o.parentId=i.parentId,d.updateStore({curCatg:o})),a}return(0,g.default)(t,e),(0,f.default)(t,[{key:"render",value:function(){var e=this.props,t=e.app.selectSiteId,a=e.category,l=a.dataSource,n=a.curCatg,r=a.forumsData,d=a.bbsId,s=e.form.getFieldDecorator,p=(0,w.toJS)(n),f=((0,w.toJS)(l),(0,w.toJS)(r)||[]);return b.default.createElement("div",null,b.default.createElement(h.default,null,b.default.createElement(J,(0,u.default)({label:"上级频道"},R),s("parentId",{getValueFromEvent:this.handleTree,initialValue:p.parentId?p.parentId+"":0===p.parentId?p.parentId+"":""})(b.default.createElement(c.default,{showSearch:!0,treeNodeFilterProp:"label",dropdownStyle:{maxHeight:300,overflow:"auto"},treeData:(0,w.toJS)(l)}))),b.default.createElement(J,(0,u.default)({label:"频道名称"},R),s("name",{initialValue:p.name||"",rules:[{required:!0,message:"请输入频道名称",type:"string"},{validator:function(e,t,a){/^\s+/i.test(t)?a("频道名称不能以空格开头"):a()}}]})(b.default.createElement(o.default,{type:"text"}))),b.default.createElement(J,(0,u.default)({label:"对应频道模版"},R),s("pageTemplateId",{initialValue:{pageTemplateId:p.pageTemplateId}})(b.default.createElement(N.default,{siteId:t,type:"category"}))),b.default.createElement(J,(0,u.default)({label:"对应详情模版"},R),s("templateId",{initialValue:{templateId:p.templateId}})(b.default.createElement(N.default,{siteId:t,type:"detail"}))),b.default.createElement(J,(0,u.default)({label:"对应论坛版块"},R),b.default.createElement(c.default,{treeDefaultExpandAll:!0,value:d||void 0,allowClear:!0,placeholder:"请选择",onChange:this.onTreeChange},this.renderTreeNode(f))),b.default.createElement(J,{wrapperCol:{span:6,offset:5}},b.default.createElement(i.default,{type:"primary",style:{marginRight:"10px"},onClick:this.onSave},"保存"),b.default.createElement(i.default,{onClick:this.goBack},"返回"))))}}]),t}(S.Component),r=function(){var e=this;this.fromTemplateId=function(e,t){return e[t]||null},this.onSave=function(){var t=e.props,a=(t.history,t.location.search),l=t.app.selectSiteId,n=t.category,r=n.expandedRows,i=(n.getCatTree,n.curCatg),o=n.saveCatg,c=n.updateStore,s=n.bbsId,p=t.form,f=p.validateFieldsAndScroll,m=(p.resetFields,(0,w.toJS)(i)),g=(0,w.toJS)(r);f(function(t,n){if(!t){n.templateId=e.fromTemplateId(n.templateId,"templateId"),n.pageTemplateId=e.fromTemplateId(n.pageTemplateId,"pageTemplateId");var r=(0,u.default)({},m,n,{siteId:(0,w.toJS)(l)});if(delete r.template,delete r.pageTemplate,r.bbsId=s,l){0!==parseInt(r.parentId)&&-1===(0,I.default)(g,parseInt(r.parentId))&&(g.push(parseInt(r.parentId)),c({expandedRows:g}));o(r,function(){T.default.parse(a.substr(1)).id?d.default.success("保存成功",1,e.goBack()):d.default.success("添加成功",1,e.goBack())})}else d.default.error("请先建站点")}})},this.goBack=function(){var t=e.props.history;(0,e.props.category.updateStore)({curCatg:{}}),t.goBack()},this.handleTree=function(t,a,l){var n=e.props.category.dataSource,r=t||l.triggerValue;return k.Jt.tree.getNode((0,w.toJS)(n),r).id+""},this.onTreeChange=function(t){var a=e.props.category;a.bbsId;(0,a.updateStore)({bbsId:t})},this.renderTreeNode=function(t){if(0!==t.length)return t.map(function(t,a){return b.default.createElement(_,{title:t.name,key:t.fid,value:t.fid,disabled:0===t.allowpost},t.children&&e.renderTreeNode(t.children))})}},l=n))||l)||l)||l;t.default=(0,E.withRouter)(h.default.create()(F))},iPyJ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=h(a("Zx67")),r=h(a("Zrlr")),d=h(a("wxAW")),i=h(a("zwoO")),o=h(a("Pf15")),u=a("GiK3"),c=h(u),s=a("Mn8c"),p=(a("y986"),a("F8kA")),f=h(a("qkvg")),m=h(a("R/+9")),g=h(a("z4MD"));function h(e){return e&&e.__esModule?e:{default:e}}var v=(0,s.inject)("app")(l=(0,s.inject)("category")(l=(0,s.observer)(l=function(e){function t(e){return(0,r.default)(this,t),(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,o.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){return c.default.createElement("div",{className:"p-common"},c.default.createElement(p.Switch,null,c.default.createElement(p.Route,{exact:!0,path:"/category",component:f.default}),c.default.createElement(p.Route,{exact:!0,path:"/category/edit",component:m.default}),c.default.createElement(p.Route,{component:g.default})))}}]),t}(u.Component))||l)||l)||l;t.default=v},ieuX:function(e,t){},qkvg:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n,r,d=E(a("LoBt")),i=E(a("1cZb")),o=E(a("yF52")),u=E(a("Zx67")),c=E(a("Zrlr")),s=E(a("wxAW")),p=E(a("zwoO")),f=E(a("Pf15")),m=E(a("kbi+"));a("/eDY"),a("YaoS"),a("tNTX");var g=a("GiK3"),h=E(g),v=E(a("O27J")),y=a("Mn8c"),I=a("F8kA"),S=E(a("mw3O")),b=a("y986"),C=E(a("Lokx")),w=a("SFkB");function E(e){return e&&e.__esModule?e:{default:e}}a("ieuX");var k=(0,y.inject)("app")(l=(0,y.inject)("category")(l=(0,y.observer)((n=function(e){function t(e){(0,c.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));r.call(a),a.state={unmounting:!1};var l=e.category,n=e.app,d=n.selectSiteId,i=n.sites;return a.selectSiteId=d,a.selectSiteName=(0,m.default)(i,{id:d})?(0,m.default)(i,{id:d}).name:"",l.updateStore({selectSiteName:a.selectSiteName}),l.getCatTree({siteId:d}),a}return(0,f.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=v.default.findDOMNode(this.refs.table).querySelector(".ant-table-tbody"),a=void 0,l=void 0,n=void 0;this.sortable=new C.default(t,{draggable:".ant-table-row",onMove:function(e){var t=e.dragged,r=e.related;return t.children[0].getAttribute("data-pid")==r.children[0].getAttribute("data-pid")&&(a=t.children[0].getAttribute("data-pid"),l=t.children[0].getAttribute("data-id"),n=r.children[0].getAttribute("data-id"),!0)},onEnd:function(t){var r=t.oldIndex,d=t.newIndex;t.target;if(r!==d){for(var i=e.props.category,o=i.dataSource,u=i.updateStore,c=i.updateSorts,s=(0,b.toJS)(o),p=w.Jt.tree.getNode(s,l),f=(w.Jt.tree.getNode(s,n),w.Jt.tree.getNode(s,a).children),m=void 0,g=void 0,h=0;h<f.length&&(f[h].id==l?m=h:f[h].id==n&&(g=h),!m||!g);h++);f.splice(m,1),f.splice(g,0,p),f=m<g?f.slice(m,g+1):f.slice(g,m+1);for(var v=[],y=[],I=0;I<f.length;I++)v.push(f[I].id),y.push(f[I].sort);y.sort(function(e,t){return t-e});for(var S=[],C=0;C<f.length;C++)f[C].sort=y[C],S.push({id:v[C],sort:y[C]});u({dataSource:s}),c(S)}}})}},{key:"componentWillReact",value:function(){var e=this.props,t=e.app,a=t.selectSiteId,l=t.sites,n=e.category;this.selectSiteId!=a&&(n.getCatTree({siteId:a}),n.updateStore({expandedRows:[1]}),this.selectSiteName=(0,m.default)(l,{id:a})?(0,m.default)(l,{id:a}).name:"",n.updateStore({selectSiteName:this.selectSiteName})),this.selectSiteId=a}},{key:"componentWillUnmount",value:function(){this.state.unmounting=!0}},{key:"render",value:function(){var e=this.props,t=(e.app.selectSiteId,e.category),a=t.dataSource,l=t.loading,n=t.expandedRows;return h.default.createElement("div",null,h.default.createElement(o.default,{simple:!0,bordered:!0,ref:"table",columns:this.getColumns(),dataSource:(0,b.toJS)(a),loading:l,rowKey:function(e){return e.id},pagination:!1,expandedRowKeys:(0,b.toJS)(n),onExpandedRowsChange:this.onExpandedRowsChange}))}}]),t}(g.Component),r=function(){var e=this;this.editCatg=function(t,a){var l=e.props.history;"add"===a?l.push({pathname:"/category/edit",search:"?"+S.default.stringify({parentId:t})}):l.push({pathname:"/category/edit",search:"?"+S.default.stringify({id:t})})},this.deleteCatg=function(t){var a=e.props,l=a.app.selectSiteId,n=a.category,r=n.deleteCatg,d=n.getCatTree;r(t,function(){i.default.success("删除成功",.6),d({siteId:l})})},this.onPreview=function(t){var a=e.props.category.preview,l=window.open("","_blank");a(t,function(e){if(0==e.code){var t=e.data;t?l.location.href=t:(l.close(),i.default.error("预览失败，请检查模版是否绑定"))}})},this.getColumns=function(){return[{title:"频道名称",key:"name",dataIndex:"name",width:300,render:function(e,t){return{children:h.default.createElement("span",null,e),props:{"data-id":t.id,"data-pid":t.parentId}}}},{title:"操作",key:"operation",width:300,className:"action-col",render:function(t,a){var l=[];return 0!==a.parentId&&l.push(h.default.createElement("a",{key:"action-1",onClick:function(){return e.editCatg(a.id,"edit")}},"编辑")),0!==a.parentId&&l.push(h.default.createElement(d.default,{key:"action-2",title:"确定要删除吗？",onConfirm:function(){return e.deleteCatg(a.id)}},h.default.createElement("a",null,"删除"))),0!==a.parentId&&l.push(h.default.createElement("a",{key:"action-preview",onClick:function(){return e.onPreview(a.id)}},"预览")),l.push([h.default.createElement("a",{key:"action-3",onClick:function(){return e.editCatg(a.id,"add")}},"添加下级频道")]),l}}]},this.onExpandedRowsChange=function(t){var a=e.props.category.updateStore;e.state.unmounting||(console.log(t),a({expandedRows:t}))}},l=n))||l)||l)||l;t.default=(0,I.withRouter)(k)}});