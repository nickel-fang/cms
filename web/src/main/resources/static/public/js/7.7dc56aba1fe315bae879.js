webpackJsonp([7],{"2OgV":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=m(a("vaID")),n=m(a("vgHw")),r=m(a("Dd8w")),i=m(a("Zx67")),u=m(a("Zrlr")),d=m(a("wxAW")),o=m(a("zwoO")),s=m(a("Pf15")),f=m(a("Dc7M"));a("nclB"),a("ZJow");var c=m(a("GiK3")),p=m(a("KSGD"));function m(e){return e&&e.__esModule?e:{default:e}}a("2asT");var h=function(e){function t(e){(0,u.default)(this,t);var a=(0,o.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleClose=function(){var e=a.state.type,t=a.refs[e];t&&t.pause(),a.setState({visible:!1})},a.onOk=function(){a.handleClose()},a.onCancel=function(){a.handleClose()},a.showMediaPlayerModal=function(){a.setState({visible:!0})},a.state={visible:e.visible||!1,type:e.type||"video",name:e.name||"",url:e.url||""},a}return(0,s.default)(t,e),(0,d.default)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState((0,r.default)({},(0,f.default)(e,["onDelete"])))}},{key:"render",value:function(){var e=this.state,t=e.type,a=e.name,i=e.url,u=e.visible,d=this.props.onDelete,o={visible:u,title:"预览",onOk:this.onOk,onCancel:this.onCancel};return c.default.createElement("span",null,c.default.createElement("span",{style:{marginLeft:10}},a),c.default.createElement("a",{onClick:this.showMediaPlayerModal,style:{marginLeft:10}},"预览"),i?c.default.createElement("a",{onClick:d,style:{marginLeft:10,fontSize:16}},c.default.createElement(n.default,{type:"delete"})):void 0,c.default.createElement(l.default,(0,r.default)({},o,{className:"mediaPlayer"}),"video"===t?c.default.createElement("video",{ref:"video",src:i,controls:!0},"浏览器版本过低，不支持video"):c.default.createElement("audio",{ref:"audio",src:i,controls:!0},"浏览器版本过低，不支持audio")))}}]),t}(c.default.Component);h.propTypes={type:p.default.string,visible:p.default.bool,url:p.default.string},t.default=h},"2asT":function(e,t){},"3Z5y":function(e,t){},"74I+":function(e,t){},"96AH":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=N(a("yF52")),r=N(a("82q9")),i=N(a("rpsp")),u=N(a("vgHw")),d=N(a("0b0c")),o=N(a("IidI")),s=N(a("G3dI")),f=N(a("uuhB")),c=N(a("1cZb")),p=N(a("Dd8w")),m=N(a("LoBt")),h=N(a("Zx67")),v=N(a("Zrlr")),g=N(a("wxAW")),y=N(a("zwoO")),E=N(a("Pf15")),b=N(a("NJOH")),C=N(a("sRCy")),w=N(a("37+n")),k=N(a("l2X+")),S=N(a("kbi+"));a("tNTX"),a("6ISc"),a("Nmhe"),a("ZJow"),a("kxBb"),a("1uA9"),a("/Hhv"),a("TZP0"),a("YaoS"),a("/eDY"),a("mKHw"),a("ySR4"),a("8QNH"),a("GhWA");var L=a("GiK3"),D=N(L),_=a("Mn8c"),I=a("y986"),M=a("LkMq"),T=a("SFkB"),x=N(a("mw3O")),A=N(a("e78j"));function N(e){return e&&e.__esModule?e:{default:e}}var P=k.default.Item,O=w.default.Item,U=C.default.RangePicker,B="YYYY-MM-DD HH:mm:ss",R=b.default.Option,Y=(0,_.inject)("app")(l=(0,_.inject)("source")(l=(0,_.observer)(l=function(e){function t(e){(0,v.default)(this,t);var a=(0,y.default)(this,(t.__proto__||(0,h.default)(t)).call(this,e));a.onCreateArt=function(){var e=a.props,t=e.history,l=e.source;l.importType;(0,l.setImportType)(0),t.push(M.ROUTER_PATHS.SOURCE_EDIT)},a.onEdit=function(e){a.props.history.push({pathname:M.ROUTER_PATHS.SOURCE_EDIT,search:"?"+x.default.stringify({id:e})})},a.onDelete=function(e){var t=a.props.source,l=t.deleteArt,n=t.getInit,r=t.query;l(e,function(){var e=(0,I.toJS)(r);n(e)})},a.getColumns=function(){return[{title:"标题",dataIndex:"title",render:function(e,t){return D.default.createElement("a",{onClick:a.onEdit.bind(a,t.id)},e)}},{title:"来源",dataIndex:"importType",render:function(e){switch(e){case 0:return D.default.createElement("span",null,"手工导入");case 1:default:return D.default.createElement("span",null,"外部导入")}}},{title:"录入时间",dataIndex:"createAt"},{title:"操作",dataIndex:"",key:"action-option",render:function(e,t){return D.default.createElement("div",null,D.default.createElement(A.default,{key:"action-1",permis:"cms:source:edit"},D.default.createElement("a",{style:{marginRight:"5px"},onClick:a.onEdit.bind(a,t.id)},"编辑")),D.default.createElement(A.default,{key:"action-2",permis:"cms:source:delete"},D.default.createElement(m.default,{title:"确定删除吗",onConfirm:a.onDelete.bind(a,t.id)},D.default.createElement("a",{style:{marginRight:"5px"}},"删除"))))}}]},a.getFormData=function(){var e=a.props,t=e.source,l=(t.updateStore,t.articleList,t.dataSource,(0,e.form.getFieldsValue)());for(var n in T.Jt.array.isEmpty(l.publishDate)||(l.beginTime=l.publishDate[0].format(B),l.endTime=l.publishDate[1].format(B)),delete l.publishDate,l)l[n]||delete l[n];return l},a.onSearch=function(){var e=a.props,t=e.source,l=t.updateStore,n=t.articleList,r=(t.dataSource,e.form.getFieldsValue,a.getFormData());r.pageNumber=1,l({query:r}),n(r)},a.onPageChange=function(e){var t=a.props.source,l=t.articleList,n=t.query;l((0,p.default)({},n,{pageNumber:e.current,pageSize:e.pageSize}))},a.onUploaderChange=function(e){var t=a.props.source.articleList,l=e.file.status;"done"===l?(c.default.success(e.file.name+" 导入成功."),t()):"error"===l&&c.default.error(e.file.name+" 导入失败.")},a.onImportTypeChange=function(e){var t=a.props,l=t.source,n=l.updateStore,r=l.articleList,i=(l.dataSource,t.form.getFieldsValue,a.getFormData());i.pageNumber=1,i.importType=e,n({query:i}),r(i)},a.onBatchMenuClick=function(e){var t=e.key,l=a.props.source,n=l.selArts,r=l.deleteArts;if("delete"===t){if(0===n.length)return void c.default.error("请选择文章");for(var i=[],u=0;u<n.length;u++)i.push(n[u].id);r(i)}},a.getBatchMenu=function(){return D.default.createElement(k.default,{onClick:a.onBatchMenuClick},D.default.createElement(P,{key:"delete"},"批量删除"))};var l=e.source,n=e.app,r=n.selectSiteId;n.sites;return a.selectSiteId=r,l.getInit({siteId:r}),a}return(0,E.default)(t,e),(0,g.default)(t,[{key:"componentWillReact",value:function(){var e=this.props,t=e.app,a=t.selectSiteId,l=t.sites,n=e.source,r=(n.articleList,n.getInit);this.selectSiteId!=a&&(r({siteId:a}),this.selectSiteName=(0,S.default)(l,{id:a})?(0,S.default)(l,{id:a}).name:""),this.selectSiteId=a}},{key:"componentWillUnmount",value:function(){var e=this.props.source;e.query;(0,e.updateStore)({query:{}})}},{key:"render",value:function(){var e=this.props,t=e.source,a=t.dataSource,l=t.pagination,c=t.selArts,m=t.loading,h=t.updateStore,v=e.app.selectSiteId,g=e.form.getFieldDecorator,y=(0,I.toJS)(c).map(function(e){return e.id}),E={action:"/auth/import",accept:"application/x-zip-compressed",name:"file",multiple:!0,showUploadList:!1,data:{siteId:v},onChange:this.onUploaderChange},C={selectedRowKeys:y,onChange:function(e,t){h({selArts:t})}};return D.default.createElement("div",null,D.default.createElement(w.default,null,D.default.createElement(d.default,{gutter:8},D.default.createElement(s.default,{span:8},D.default.createElement(O,(0,p.default)({label:"稿件标题"},{labelCol:{span:6},wrapperCol:{span:18}}),g("title",{initialValue:""})(D.default.createElement(f.default,null)))),D.default.createElement(s.default,{span:4},D.default.createElement(O,(0,p.default)({label:"来源"},{labelCol:{span:6},wrapperCol:{span:18}}),g("importType",{initialValue:""})(D.default.createElement(b.default,{placeholder:"全部",onChange:this.onImportTypeChange},D.default.createElement(R,{value:""},"全部"),D.default.createElement(R,{value:"0"},"手工导入"),D.default.createElement(R,{value:"1"},"外部导入"))))),D.default.createElement(s.default,{span:10},D.default.createElement(O,(0,p.default)({label:"录入时间"},{labelCol:{span:6},wrapperCol:{span:18}}),g("publishDate",{initialValue:null})(D.default.createElement(U,{showTime:!0,format:B})))),D.default.createElement(s.default,{span:2},D.default.createElement(O,null,D.default.createElement(o.default,{type:"primary",style:{marginLeft:"20px"},onClick:this.onSearch},"查询")))),D.default.createElement(d.default,{gutter:8},D.default.createElement(s.default,{span:3},D.default.createElement(i.default,E,D.default.createElement(o.default,{type:"primary",style:{marginBottom:"20px",marginLeft:"20px"}},D.default.createElement(u.default,{type:"upload"}),"导入文件"))),D.default.createElement(s.default,{span:4},D.default.createElement(o.default,{type:"primary",onClick:this.onCreateArt,style:{marginBottom:"20px",marginLeft:"20px"}},"新建"))),D.default.createElement(d.default,null,D.default.createElement("p",{style:{marginTop:"-10px",color:"grey",marginBottom:"20px",marginLeft:"20px"}},"(仅支持上传.zip格式文件)")),D.default.createElement(d.default,null,D.default.createElement(s.default,{span:18,style:{marginBottom:"30px"}},D.default.createElement(r.default.Button,{overlay:this.getBatchMenu()},"批量操作")))),D.default.createElement(n.default,{ref:"table",className:"draggable-table",simple:!0,bordered:!0,columns:this.getColumns(),dataSource:(0,I.toJS)(a),rowKey:function(e){return e.id},loading:m,pagination:l,onChange:this.onPageChange,rowSelection:C}))}}]),t}(L.Component))||l)||l)||l;t.default=w.default.create()(Y)},TUAy:function(e,t){},e78j:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=p(a("Zx67")),r=p(a("Zrlr")),i=p(a("wxAW")),u=p(a("zwoO")),d=p(a("Pf15")),o=a("GiK3"),s=p(o),f=a("Mn8c"),c=a("y986");function p(e){return e&&e.__esModule?e:{default:e}}var m=(0,f.inject)("app")(l=(0,f.observer)(l=function(e){function t(e){return(0,r.default)(this,t),(0,u.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,d.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.children,a=e.app.user,l=e.permis;return((0,c.toJS)(a.permissions)||[]).findIndex(function(e,t){return new RegExp("^"+e).test(l)})>=0?s.default.createElement("span",null,t):null}}]),t}(o.Component))||l)||l;t.default=m},fqKR:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=v(a("Zx67")),r=v(a("Zrlr")),i=v(a("wxAW")),u=v(a("zwoO")),d=v(a("Pf15")),o=a("GiK3"),s=v(o),f=a("Mn8c"),c=(a("y986"),a("F8kA")),p=v(a("96AH")),m=v(a("ofQd")),h=v(a("z4MD"));function v(e){return e&&e.__esModule?e:{default:e}}var g=(0,f.inject)("site")(l=(0,f.observer)(l=function(e){function t(e){return(0,r.default)(this,t),(0,u.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,d.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return s.default.createElement("div",{className:"p-common"},s.default.createElement(c.Switch,null,s.default.createElement(c.Route,{exact:!0,path:"/cms/source",component:p.default}),s.default.createElement(c.Route,{exact:!0,path:"/cms/source/edit",component:m.default}),s.default.createElement(c.Route,{component:h.default})))}}]),t}(o.Component))||l)||l;t.default=(0,c.withRouter)(g)},kRBA:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=E(a("rpsp")),n=E(a("vgHw")),r=E(a("woOf")),i=E(a("Dd8w")),u=E(a("Zx67")),d=E(a("Zrlr")),o=E(a("wxAW")),s=E(a("zwoO")),f=E(a("Pf15")),c=E(a("uuhB")),p=E(a("qB1w"));a("Nmhe"),a("ZJow"),a("TZP0"),a("FV/t");var m=E(a("GiK3")),h=E(a("KSGD")),v=a("LkMq");a("p/XX");var g=E(a("y3TK")),y=E(a("2OgV"));function E(e){return e&&e.__esModule?e:{default:e}}var b=p.default.TabPane,C=(c.default.Group,function(e){function t(e){(0,d.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));a.onCoverChange=function(e){var t=a.state.coverImg;"done"==e.file.status&&e.file.response&&0==e.file.response.code&&e.file.response.data&&(t=e.file.response.data.fileUrl),a.setState({coverImg:t}),a.triggerChange({coverImg:t})},a.onUrlChange=function(e){var t=e.target.value;a.setState({url:t,id:""}),a.triggerChange({url:t,id:""})},a.onMediaChange=function(e){if(e&&e.newMediaData&&e.newMediaData.length>0){var t=e.newMediaData[0],l={id:t.id,coverImg:t.cover||a.state.coverImg||"",url:t.hdUrl||t.mp3BigUrl,type:t.hdUrl?"video":"audio",name:t.name};a.setState((0,i.default)({},l)),a.triggerChange((0,i.default)({},l))}},a.triggerChange=function(e){var t=a.props.onChange;if(t){var l=a.state,n=l.coverImg,i=l.url,u=l.id;t((0,r.default)({},{coverImg:n,url:i,id:u},e))}};var l=e.value||{coverImg:"",url:"",id:""};return a.state=(0,i.default)({},l,{type:a.props.type||"video"}),a}return(0,f.default)(t,e),(0,o.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.value;this.setState((0,i.default)({},t))}},{key:"render",value:function(){var e=this,t=this.state,a=t.id,r=t.type,i=t.url,u=t.coverImg,d={type:r,name:t.name,url:i,onDelete:function(){e.triggerChange({id:"",name:"",url:"",coverImg:""})}};return m.default.createElement("div",null,m.default.createElement(p.default,{defaultActiveKey:i&&!a?"2":"1",className:"tabCon"},m.default.createElement(b,{tab:m.default.createElement("span",null,m.default.createElement(n.default,{type:"appstore-o"}),"从媒体库选择"),key:"1"},m.default.createElement(g.default,{type:r,onChange:this.onMediaChange}),m.default.createElement(y.default,d)),m.default.createElement(b,{tab:m.default.createElement("span",null,m.default.createElement(n.default,{type:"link"}),"输入文件地址"),key:"2"},m.default.createElement(c.default,{style:{width:"80%"},value:i,placeholder:"请输入文件地址",onChange:this.onUrlChange}),m.default.createElement("span",{className:"mediaPlayer"},m.default.createElement(y.default,d)))),m.default.createElement(l.default,{className:"cover-uploader",name:"file",showUploadList:!1,action:v.urlPath.UPLOAD_FILE,onChange:function(t){return e.onCoverChange(t)}},u?m.default.createElement("img",{src:u,alt:"",className:"cover-img"}):m.default.createElement(n.default,{type:"plus",className:"cover-uploader-trigger"})),m.default.createElement("div",{className:"decWarper"},m.default.createElement("span",null,"封面图片")))}}]),t}(m.default.Component));C.propTypes={value:h.default.object},t.default=C},mrfJ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=C(a("vaID")),n=C(a("IidI")),r=C(a("0b0c")),i=C(a("ExGt")),u=C(a("uuhB")),d=C(a("G3dI")),o=C(a("vgHw")),s=C(a("1cZb")),f=C(a("Dd8w")),c=C(a("Zx67")),p=C(a("Zrlr")),m=C(a("wxAW")),h=C(a("zwoO")),v=C(a("Pf15")),g=C(a("rpsp")),y=C(a("37+n"));a("nclB"),a("1uA9"),a("kxBb"),a("2r77"),a("TZP0"),a("/Hhv"),a("ZJow"),a("YaoS"),a("Nmhe"),a("8QNH");var E=C(a("GiK3")),b=a("LkMq");function C(e){return e&&e.__esModule?e:{default:e}}a("74I+");y.default.Item;var w=g.default.Dragger,k=function(e){function t(e){(0,p.default)(this,t);var a=(0,h.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e)),l=a.props,n=l.accept,r=l.value,i=void 0===r?{}:r;return n||(n=[],b.IMG_UPLOAD_TYEPS.forEach(function(e){n.push("image/"+e)}),n=n.join(",")),a.state={accept:n,bamv:!1,fileList:i.fileList||[]},a}return(0,v.default)(t,e),(0,m.default)(t,[{key:"componentWillReceiveProps",value:function(e){if(e.value){var t=e.value.fileList||[];this.setState({fileList:t})}}},{key:"remove",value:function(e){var t=this.state.fileList.filter(function(t){return t.key!==e});this.setState({fileList:t}),this.triggerChange({fileList:t})}},{key:"add",value:function(){var e=this.state.fileList;e.map(function(e,t){e.key=t}),e.push({key:e.length,url:"",dec:""}),this.setState({fileList:e}),this.triggerChange({fileList:e})}},{key:"batchAdd",value:function(){var e=this.state.fileList,t=this.batchList||[],a=e.length;t.forEach(function(t,l){e.push({key:a+l,url:t.fileUrl,width:t.width,height:t.height,dec:""})}),this.setState({fileList:e}),this.triggerChange({fileList:e}),this.hideBam()}},{key:"showBam",value:function(){this.setState({bamv:!0})}},{key:"hideBam",value:function(){this.setState({bamv:!1})}},{key:"move",value:function(e,t){var a=this.state.fileList;if(!("up"==t&&0==e||"down"==t&&e==a.length-1)){"up"==t&&(e-=1);for(var l=0,n=a.length;l<n;l++)if(a[l].key==e){var r=(0,f.default)({},a[l]),i=(0,f.default)({},a[l+1]);a[l]=(0,f.default)({},i,{key:r.key}),a[l+1]=(0,f.default)({},r,{key:i.key});break}this.setState({fileList:a}),this.triggerChange({fileList:a})}}},{key:"handleUploadChange",value:function(e,t){var a=this.state.fileList,l=e.file;if("done"===l.status)if(l.response&&-1==l.response.code)s.default.error(l.response.msg);else if(l.response&&0==l.response.code&&l.response.data){var n=e.file.response.data,r=n.fileUrl,i=n.width,u=n.height;a.map(function(e){e.key==t&&(e.url=r,e.width=i,e.height=u)})}this.setState({fileList:a}),this.triggerChange({fileList:a})}},{key:"handleBatchUploadChange",value:function(e){var t=[];e.fileList.forEach(function(e){if("done"===e.status)if(e.response&&e.response.code<0)s.default.error(e.response.msg);else{var a=e.response.data,l=a.fileUrl,n=a.width,r=a.height;t.push({fileUrl:l,width:n,height:r})}}),this.batchList=t}},{key:"handleInputChange",value:function(e,t){var a=e.target.value,l=this.state.fileList;l.map(function(e){e.key==t&&(e.dec=a)}),this.setState({fileList:l}),this.triggerChange({fileList:l})}},{key:"triggerChange",value:function(e){var t=this.props.onChange;t&&t((0,f.default)({},this.state,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.fileList,s=t.bamv,c=t.accept,p=a.map(function(t,l){var n=t.url;return E.default.createElement("div",{key:t.key,className:"album-item"},E.default.createElement(r.default,{type:"flex",justify:"space-between",align:"top"},E.default.createElement(d.default,{span:3},E.default.createElement(g.default,{className:"album-uploader",name:"file",accept:c,showUploadList:!1,action:b.urlPath.UPLOAD_FILE,onChange:function(a){return e.handleUploadChange(a,t.key)}},n?E.default.createElement("div",{className:"album-image-wrap"},E.default.createElement("img",{src:n,className:"album-img"})):E.default.createElement(o.default,{type:"plus",className:"album-uploader-trigger"}))),E.default.createElement(d.default,{span:18},E.default.createElement(u.default,{type:"textarea",rows:5,value:t.dec,onChange:function(a){return e.handleInputChange(a,t.key)}})),E.default.createElement(d.default,{span:3},E.default.createElement(i.default,{title:"删除",placement:"top"},E.default.createElement(o.default,{className:"del-btn",type:"minus-circle-o",disabled:1===a.length,onClick:function(){return e.remove(t.key)}})),E.default.createElement(i.default,{title:"向上移动",placement:"top"},E.default.createElement(o.default,{type:"up-circle-o",disabled:0==l,onClick:function(){return e.move(t.key,"up")}})),E.default.createElement(i.default,{title:"向下移动",placement:"top"},E.default.createElement(o.default,{type:"down-circle-o",disabled:l==a.length-1,onClick:function(){return e.move(t.key,"down")}})))))}),m={visible:s,title:"批量添加",onCancel:this.hideBam.bind(this),onOk:this.batchAdd.bind(this)};return E.default.createElement("div",{className:"m-album"},p,E.default.createElement("div",null,E.default.createElement(n.default,{type:"dashed",onClick:this.add.bind(this)},E.default.createElement(o.default,{type:"plus"})," 添加一项"),E.default.createElement(n.default,{type:"dashed",className:"batch-add-btn",onClick:this.showBam.bind(this)},E.default.createElement(o.default,{type:"plus"})," 批量添加")),E.default.createElement(l.default,(0,f.default)({},m,{className:"batch-upload-modal"}),E.default.createElement("div",{className:"drag-wrap"},E.default.createElement(w,{accept:c,multiple:!0,showUploadList:!0,action:b.urlPath.UPLOAD_FILE,onChange:this.handleBatchUploadChange.bind(this)},E.default.createElement("p",{className:"ant-upload-drag-icon"},E.default.createElement(o.default,{type:"inbox"}))))))}}]),t}(E.default.Component);t.default=k},nDJ2:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=h(a("vaID")),n=h(a("rpsp")),r=h(a("vgHw")),i=h(a("pFYg")),u=h(a("1cZb")),d=h(a("Zx67")),o=h(a("Zrlr")),s=h(a("wxAW")),f=h(a("zwoO")),c=h(a("Pf15"));a("nclB"),a("Nmhe"),a("ZJow"),a("YaoS");var p=h(a("GiK3")),m=a("LkMq");function h(e){return e&&e.__esModule?e:{default:e}}a("TUAy");var v=function(e){function t(e){(0,o.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));a.imgSave=function(e,t){var l=a.state.fileList;l[e].url=t,a.setState({fileList:l,previewVisible:!1})},a.handlePreview=function(e){a.setState({previewImage:e.url,previewVisible:!0,previewIndex:e.index})},a.handleChange=function(e){var t=e.file,l=e.fileList;"error"==t.status?l=a.state.fileList:t.response&&0!==t.response.code?(u.default.error(t.response.msg),l=l.filter(function(e){return e.uid!==t.uid})):(a.props.single&&(l=l.slice(-1)),l=(l=l.map(function(e,t){return e.response&&0===e.response.code&&e.response.data&&(e={name:e.name,url:e.response.data.fileUrl,uid:e.uid,index:t}),e})).filter(function(e){return!e.response||0===e.response.code})),a.setState({fileList:l});var n=a.props.onChange;(n&&"done"==t.status||"removed"==t.status)&&n({fileList:l})},a.handleCancel=function(){a.setState({previewVisible:!1})};var l=a.props,n=l.accept,r=l.value,s=void 0===r?{}:r;return s.fileList&&s.fileList.map(function(e,t){void 0===(0,i.default)(e.uid)&&(e.uid=-(t+1)),e.index=t}),n||(n=[],m.IMG_UPLOAD_TYEPS.forEach(function(e){n.push("image/"+e)}),n=n.join(",")),a.state={accept:n,previewVisible:!1,previewImage:"",fileList:s.fileList||[]},a}return(0,c.default)(t,e),(0,s.default)(t,[{key:"componentWillReceiveProps",value:function(e){if("value"in e&&e.value){var t=e.value;t.fileList&&t.fileList.map(function(e,t){e.index=t});var a={fileList:t.fileList||[]};this.setState(a)}}},{key:"render",value:function(){var e=this.state,t=e.accept,a=e.previewVisible,i=e.previewImage,u=(e.previewIndex,e.fileList),d=this.props,o=(d.width,d.height,d.ratio,p.default.createElement("div",null,p.default.createElement(r.default,{type:"plus"}),p.default.createElement("div",{className:"ant-upload-text"},this.props.tip||"上传")));return p.default.createElement("div",{className:"clearfix"},p.default.createElement(n.default,{accept:t,action:m.urlPath.UPLOAD_FILE,listType:"picture-card",fileList:u,onPreview:this.handlePreview,onChange:this.handleChange,multiple:!this.props.single,className:"img-uploader"},this.props.single&&u.length>=1?null:o),p.default.createElement(l.default,{title:"图片预览",width:640,visible:a,footer:null,onCancel:this.handleCancel},p.default.createElement("img",{alt:"example",style:{width:"100%"},src:i})))}}]),t}(p.default.Component);t.default=v},ofQd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n,r,i=U(a("1cZb")),u=U(a("IidI")),d=U(a("sRCy")),o=U(a("0b0c")),s=U(a("G3dI")),f=U(a("Dd8w")),c=U(a("Zx67")),p=U(a("Zrlr")),m=U(a("wxAW")),h=U(a("zwoO")),v=U(a("Pf15")),g=U(a("VCGi")),y=U(a("uuhB")),E=U(a("NJOH")),b=U(a("37+n")),C=U(a("Q7hp")),w=U(a("Dc7M"));a("YaoS"),a("1uA9"),a("ySR4"),a("kxBb"),a("/Hhv"),a("6opi"),a("TZP0"),a("mKHw"),a("8QNH");var k=a("GiK3"),S=U(k),L=a("F8kA"),D=a("Mn8c"),_=a("y986"),I=a("SFkB"),M=U(a("mw3O")),T=U(a("kvC3")),x=U(a("PJh5")),A=a("LkMq"),N=U(a("nDJ2")),P=U(a("mrfJ")),O=U(a("kRBA"));function U(e){return e&&e.__esModule?e:{default:e}}var B=b.default.Item,R=E.default.Option,Y=y.default.TextArea,Z=g.default.Panel,V=(0,D.inject)("source")(l=(0,D.observer)((n=function(e){function t(e){(0,p.default)(this,t);var a=(0,h.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));r.call(a);var l=e.location.search,n=e.source,i=n.getArtItem,u=n.updateStore,d=n.setImportType,o=M.default.parse(l.substr(1));return o.id?i(o.id):(d(0),u({curArt:{}})),a}return(0,v.default)(t,e),(0,m.default)(t,[{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.form.getFieldDecorator,a=e.source.curArt;return S.default.createElement(b.default,null,S.default.createElement(o.default,null,S.default.createElement(s.default,{span:12},S.default.createElement(B,(0,f.default)({label:"肩标题"},{labelCol:{span:4},wrapperCol:{span:20}}),t("introTitle",{initialValue:a.introTitle})(S.default.createElement(y.default,{placeholder:"请输入肩标题"})))),S.default.createElement(s.default,{span:12},S.default.createElement(B,(0,f.default)({label:"列表标题"},{labelCol:{span:4},wrapperCol:{span:20}}),t("listTitle",{initialValue:a.listTitle})(S.default.createElement(y.default,{placeholder:"请输入列表标题"}))))),S.default.createElement(o.default,null,S.default.createElement(s.default,{span:12},S.default.createElement(B,(0,f.default)({label:"标题"},{labelCol:{span:4},wrapperCol:{span:20}}),t("title",{initialValue:a.title,rules:[{required:!0,message:"请输入标题"}]})(S.default.createElement(y.default,{placeholder:"请输入标题"})))),S.default.createElement(s.default,{span:6},S.default.createElement(B,(0,f.default)({label:"作者"},{labelCol:{span:8},wrapperCol:{span:16}}),t("authors",{initialValue:a.authors})(S.default.createElement(y.default,{placeholder:"请输入作者"})))),S.default.createElement(s.default,{span:6},S.default.createElement(B,(0,f.default)({label:"责任编辑"},{labelCol:{span:8},wrapperCol:{span:16}}),t("responsibleUser",{initialValue:a.responsibleUser})(S.default.createElement(y.default,{placeholder:"请输入责任编辑"}))))),S.default.createElement(o.default,null,S.default.createElement(s.default,{span:12},S.default.createElement(B,(0,f.default)({label:"副标题"},{labelCol:{span:4},wrapperCol:{span:20}}),t("subTitle",{initialValue:a.subTitle})(S.default.createElement(y.default,{placeholder:"请输入副标题"})))),S.default.createElement(s.default,{span:6},S.default.createElement(B,(0,f.default)({label:"来源"},{labelCol:{span:8},wrapperCol:{span:16}}),t("source",{initialValue:a.source})(S.default.createElement(y.default,{placeholder:"请输入来源"})))),S.default.createElement(s.default,{span:6},S.default.createElement(B,(0,f.default)({label:"发布时间"},{labelCol:{span:8},wrapperCol:{span:16}}),t("publishDate",{initialValue:void 0!==a.publishDate?(0,x.default)(a.publishDate,"YYYY-MM-DD HH:mm:ss"):(0,x.default)((new Date).format("yyyy-MM-dd hh:mm:ss"))})(S.default.createElement(d.default,{style:{width:"200px"},popupStyle:{zIndex:"9999"},showTime:!0,format:"YYYY-MM-DD HH:mm:ss"}))))),S.default.createElement(o.default,null,S.default.createElement(s.default,{span:12},S.default.createElement(s.default,{span:24},S.default.createElement(B,(0,f.default)({label:"摘要"},{labelCol:{span:4},wrapperCol:{span:20}}),t("description",{initialValue:a.description})(S.default.createElement(Y,{autosize:{minRows:4,maxRows:6},placeholder:"请输入摘要"}))))),S.default.createElement(s.default,{span:6},S.default.createElement(B,(0,f.default)({label:"稿件类型"},{labelCol:{span:8},wrapperCol:{span:16}}),t("type",{initialValue:a.type||"common"})(S.default.createElement(E.default,{onChange:this.onTypeChg},A.TYPES.map(function(e){return S.default.createElement(R,{key:e.key,value:e.key},e.label)})))))),S.default.createElement(o.default,{type:"flex",justify:"center"},S.default.createElement(u.default,{onClick:this.handleOnSave.bind(this,2),type:"primary",style:{marginBottom:"20px",marginRight:"20px"}},"暂存"),S.default.createElement(u.default,{onClick:this.handleOnSave.bind(this,0),type:"primary",style:{marginBottom:"20px",marginRight:"20px"}},"保存并返回"),S.default.createElement(u.default,{onClick:this.handleOnSave.bind(this,1),type:"primary",style:{marginBottom:"20px",marginRight:"20px"}},"继续添加"),S.default.createElement(u.default,{style:{marginBottom:"20px"},onClick:this.goBack},"取消")),S.default.createElement("div",null,S.default.createElement(T.default,{ref:"ueditor",initialContent:(0,C.default)(a,"articleData.content")})),this.getThumbnailTpl(),this.getAlbumTpl(),this.getAudioTpl(),this.getVideoTpl())}}]),t}(k.Component),r=function(){var e=this;this.goBack=function(){e.props.history.goBack()},this.fromAlbum=function(e){var t=e.fileList,a=[];return(void 0===t?[]:t).forEach(function(e){e.url&&a.push({index:+e.key,image:e.url,description:e.dec,width:e.width,height:e.height})}),a},this.fromThumbnail=function(e){var t=e.fileList,a=void 0===t?[]:t;if(0===a.length)return"";var l=[];return a.forEach(function(e){l.push(e.url)}),l.join(",")},this.handleOnSave=function(t){var a=e.props,l=a.source,n=l.curArt,r=l.onSaveArticle,u=l.importType,d=(l.setImportType,l.updateStore),o=l.albumNum,s=l.audioNum,c=l.videoNum,p=a.form,m=p.getFieldsValue,h=p.resetFields,v=(a.history,(0,f.default)({articleData:(0,f.default)({},(0,w.default)(n.articleData,["audios","audioJson","videos","videoJson","images","imageJson"]))},(0,w.default)((0,_.toJS)(n),"articleData"),m()));v.publishDate&&(v.publishDate=v.publishDate.format("YYYY-MM-DD HH:mm:ss")),v.thumbnail&&(v.imageUrl=e.fromThumbnail(v.thumbnail)),1===o?v.articleData.imageJson=e.fromAlbum(v.album):delete v.articleData.imageJson,delete v.album;var g=[];1===s?(v.audio.id?g.push(v.audio.id):v.audioUrl=v.audio.url,v.audioCover=v.audio.coverImg):(delete v.audioUrl,delete v.audioCover),delete v.audio,1===c?(v.video.id?g.push(v.video.id):v.videoUrl=v.video.url,v.videoCover=v.video.coverImg):(delete v.videoUrl,delete v.videoCover),delete v.video,v.mediaIds=g;var y=v.articleData.imageJson;if("image"===v.type&&y.length<1)return i.default.error("图集请至少上传一张图片"),!1;var E=(0,f.default)({},v);null!==u&&(E.importType=u);E.articleData.content=e.refs.ueditor.getContent(),r(E,1===t?function(){h(),d({curArt:{type:E.type}}),e.refs.ueditor.setContent("")}:2===t?function(e){var t=e.data;d({curArt:t}),i.default.info("保存成功！")}:function(){h(),e.goBack(),i.default.success("保存成功")})},this.onTypeChg=function(t){var a=e.props.source,l=a.curArt;(0,a.updateStore)({albumNum:"image"===t?1:0,videoNum:"video"===t?1:0,audioNum:"audio"===t?1:0,curArt:(0,f.default)({},l,{type:t})})},this.toThumbnail=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return{};var t=[];return e.split(",http").forEach(function(e,a){a>0&&(e="http"+e),t.push({uid:-(a+1),name:e,url:e})}),{fileList:t}},this.getThumbnailTpl=function(){var t=e.props,a=t.source.curArt,l=t.form.getFieldDecorator;return S.default.createElement(B,null,l("thumbnail",{initialValue:e.toThumbnail(a.imageUrl)})(S.default.createElement(N.default,{single:!0,tip:"上传缩略图"})))},this.getAlbumTpl=function(){var t=e.props,a=t.source,l=a.albumNum,n=(a.curArt,t.form.getFieldDecorator);return 0===l?null:S.default.createElement(g.default,{defaultActiveKey:["album"]},S.default.createElement(Z,{key:"album",header:"图集"},S.default.createElement(B,null,n("album",{initialValue:e.toAlbum()})(S.default.createElement(P.default,null)))))},this.getAudioTpl=function(){var t=e.props,a=t.source,l=a.audioNum,n=(a.curArt,t.form.getFieldDecorator);return 0===l?null:S.default.createElement(g.default,{defaultActiveKey:["audio"]},S.default.createElement(Z,{key:"audio",header:"音频"},S.default.createElement(B,null,n("audio",{initialValue:e.toMedia("audio")})(S.default.createElement(O.default,{type:"audio"})))))},this.getVideoTpl=function(){var t=e.props,a=t.source,l=a.videoNum,n=(a.curArt,t.form.getFieldDecorator);return 0===l?null:S.default.createElement(g.default,{defaultActiveKey:["video"]},S.default.createElement(Z,{key:"video",header:"视频"},S.default.createElement(B,null,n("video",{initialValue:e.toMedia("video")})(S.default.createElement(O.default,{type:"video"})))))},this.toAlbum=function(){var t=e.props.source.curArt.articleData,a=(void 0===t?{}:t).imageJson||[];if(I.Jt.array.isEmpty(a))return{fileList:[]};var l=[];return a.forEach(function(e,t){l.push({key:t,url:e.image,dec:e.description,width:e.width,height:e.height})}),{fileList:l}},this.toMedia=function(t){var a=e.props.source.curArt.articleData,l=void 0===a?{}:a,n="video"===t?l.videoJson:l.audioJson;if(I.Jt.array.isEmpty(n))return{id:"",url:"",coverImg:"",name:""};var r=n[0];return{id:r.id,url:r.resources[0].url,coverImg:r.image,name:r.title}}},l=n))||l)||l;t.default=(0,L.withRouter)(b.default.create()(V))},"p/XX":function(e,t){},y3TK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=_(a("vaID")),r=_(a("yF52")),i=_(a("uuhB")),u=_(a("vgHw")),d=_(a("IidI")),o=_(a("8Uiw")),s=_(a("1cZb")),f=_(a("Dd8w")),c=_(a("woOf")),p=_(a("Zx67")),m=_(a("Zrlr")),h=_(a("wxAW")),v=_(a("zwoO")),g=_(a("Pf15")),y=_(a("sRCy")),E=_(a("NJOH")),b=_(a("rpsp")),C=_(a("qB1w")),w=_(a("37+n"));a("nclB"),a("tNTX"),a("TZP0"),a("ZJow"),a("1uA9"),a("dcJ6"),a("YaoS"),a("ySR4"),a("mKHw"),a("Nmhe"),a("FV/t"),a("8QNH");var k=_(a("GiK3")),S=_(a("KSGD")),L=a("Mn8c"),D=(a("y986"),a("LkMq"));function _(e){return e&&e.__esModule?e:{default:e}}a("3Z5y");var I=w.default.Item,M=C.default.TabPane,T=b.default.Dragger,x=(E.default.Option,y.default.RangePicker),A={name:"file",multiple:!0,showUploadList:!1,action:D.urlPath.UPLOAD_FILES},N=[{title:"文件",dataIndex:"file",render:function(e,t,a){return{children:k.default.createElement("div",null,e.cover?k.default.createElement("img",{src:e.cover,className:"coverImg"}):"",k.default.createElement("h3",null,k.default.createElement("a",null," ",e.name)),k.default.createElement("br",null),k.default.createElement("span",null," ",e.autoName)),props:{}}}},{title:"大小",dataIndex:"size"},{title:"上传时间",dataIndex:"uploadTime",render:function(e,t,a){return e?new Date(e).format("yyyy-MM-dd hh:mm:ss"):""}}],P=(0,L.inject)("app")(l=(0,L.observer)(l=function(e){function t(e){(0,m.default)(this,t);var a=(0,v.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return a.queryMediaList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=a.props.app.getMediaList,l=(0,c.default)({pageNumber:1,pageSize:D.PAGE_SIZE},e);t((0,f.default)({},l))},a.showModal=function(){a.setState({visible:!0}),(0,a.props.form.resetFields)(),a.queryMediaList({type:a.state.type})},a.handleOk=function(){a.setState({loading:!0});var e=a.props.app.mediaList.filter(function(e){return a.state.selectedRowKeys==e.id}),t=a.props.onChange;t&&t((0,c.default)({},{newMediaData:e})),a.setState({loading:!1,visible:!1})},a.handleCancel=function(){a.setState({visible:!1})},a.handleSearch=function(){var e=(0,a.props.form.getFieldsValue)();e.date&&0!==e.date.length&&(e.startTime=e.date[0].format("YYYY-MM-DD"),e.endTime=e.date[1].format("YYYY-MM-DD")),e.keyword||delete e.keyword,delete e.date,e.pageNumber=1,e.type=a.state.type,a.queryMediaList(e)},a.handleSelectTypeChange=function(e){a.setState({type:e}),a.queryMediaList({type:e})},a.onMideaSelectChange=function(e){a.setState({selectedRowKeys:e})},a.onUploaderChange=function(e){var t=e.file.status;"uploading"===t&&a.setState({uploadFileList:e.fileList}),"done"===t?s.default.success(e.file.name+" 上传成功."):"error"===t&&s.default.error(e.file.name+" 上传失败.")},a.state={selectedRowKeys:[],loading:!1,visible:!1,uploadFileList:[],type:e.type||"video"},a}return(0,g.default)(t,e),(0,h.default)(t,[{key:"componentWillReceiveProps",value:function(e){e.type!==this.props.type&&this.setState({type:this.props.type})}},{key:"render",value:function(){var e=this.state,t=e.type,a=e.selectedRowKeys,l=this.props.form.getFieldDecorator,s=this.props.app,c=s.mediaList,p=s.mediaListPagination,m=s.getMediaList,h={type:"radio",selectedRowKeys:a,onChange:this.onMideaSelectChange},v={dataSource:c.map(function(e,t){return{key:e.id,file:{cover:e.cover||"",name:e.name,autoName:e.autoName,hdUrl:e.hdUrl},size:e.hdSize,uploadTime:e.uploadTime,id:e.id}}),pagination:p,onChange:function(e){m({type:t,pageNumber:e.current,pageSize:e.pageSize})}},g=this.state.uploadFileList.map(function(e,t){return k.default.createElement("div",{className:"progressWarp",key:e.uid},"上传文件“",e.name,"” ",k.default.createElement(o.default,{percent:e.percent}))});return k.default.createElement("span",null,k.default.createElement(d.default,{type:"primary",icon:"appstore-o",onClick:this.showModal},"选择媒体文件"),k.default.createElement(n.default,{wrapClassName:"media-modal-wrap",visible:this.state.visible,title:"选择媒体文件",width:"90%",onOk:this.handleOk,onCancel:this.handleCancel,footer:[k.default.createElement(d.default,{key:"back",onClick:this.handleCancel},"取消"),k.default.createElement(d.default,{key:"submit",type:"primary",loading:this.state.loading,onClick:this.handleOk},"确定 ")]},k.default.createElement(C.default,{type:"card",defaultActiveKey:"2"},k.default.createElement(M,{tab:"上传文件",key:"1"},k.default.createElement(T,(0,f.default)({},A,{accept:"audio"==t?"audio/mp3":"video/mp4",onChange:this.onUploaderChange,className:"draggerWarper"}),k.default.createElement("div",{className:"draggerWarp"},k.default.createElement("p",{className:"ant-upload-drag-icon"},k.default.createElement(u.default,{type:"inbox"})),k.default.createElement("p",{className:"ant-upload-text"},"拖拽到此处上传"),k.default.createElement("p",{className:"ant-upload-hint"},"支持拖拽一个或多个文件上传, 仅支持","audio"==t?"mp3":"mp4","格式文件"))),g),k.default.createElement(M,{tab:"媒体库",key:"2"},k.default.createElement("div",null,k.default.createElement(w.default,{layout:"inline"},k.default.createElement(I,null,l("date",{initialValue:null})(k.default.createElement(x,{format:"YYYY-MM-DD"}))),k.default.createElement(I,null,l("keyword",{initialValue:""})(k.default.createElement(i.default,{placeholder:"关键词",style:{width:200}}))),k.default.createElement(I,null,k.default.createElement(d.default,{type:"primary",icon:"search",onClick:this.handleSearch})))),k.default.createElement("div",{style:{marginTop:10}},k.default.createElement(r.default,(0,f.default)({rowSelection:h,columns:N},v)))))))}}]),t}(k.default.Component))||l)||l;P.propTypes={value:S.default.object,onChange:S.default.func},t.default=w.default.create()(P)}});