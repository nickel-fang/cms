webpackJsonp([4],{"23sO":function(e,t){},"2M9t":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=I(a("vaID")),r=I(a("yF52")),i=I(a("0b0c")),u=I(a("IidI")),d=I(a("G3dI")),o=I(a("uuhB")),s=I(a("Gu7T")),c=I(a("Dd8w")),f=I(a("1cZb")),p=I(a("Zx67")),m=I(a("Zrlr")),h=I(a("wxAW")),g=I(a("zwoO")),v=I(a("Pf15")),y=I(a("NJOH")),E=I(a("37+n")),b=I(a("sRCy"));a("nclB"),a("tNTX"),a("kxBb"),a("1uA9"),a("/Hhv"),a("TZP0"),a("YaoS"),a("mKHw"),a("8QNH"),a("ySR4");var C=a("GiK3"),S=I(C),w=(a("y986"),a("Mn8c")),k=a("SFkB");function I(e){return e&&e.__esModule?e:{default:e}}var x=b.default.RangePicker,D=E.default.Item,L=y.default.Option,M="YYYY-MM-DD HH:mm:ss",T=(0,w.inject)("cms")(l=(0,w.inject)("app")(l=(0,w.inject)("source")(l=(0,w.observer)(l=function(e){function t(e){(0,m.default)(this,t);var a=(0,g.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return a.handleModalOk=function(e){var t=a.props,l=t.cms,n=l.selSouArts,r=l.insertArts,i=l.query,u=t.app,d=u.selectSiteId,o=(u.sites,t.form.resetFields),s=[];if(a.selectSiteId=d,0!==n.length){for(var c=0;c<n.length;c++)0!==n[c].delFlag&&s.push(n[c]);r({list:s,categoryId:i.categoryId},function(){o()}),a.handleModalCancel()}else f.default.error("请选择文章")},a.handleModalCancel=function(){a.setState({selectedRowKeys:[]}),a.props.handleModalCancel()},a.onPageChange=function(e){var t=a.props.source,l=t.articleList,n=t.query;l((0,c.default)({},n,{pageNumber:e.current,pageSize:e.pageSize}))},a.getFormData=function(){var e=a.props,t=e.form.getFieldsValue,l=e.app,n=l.selectSiteId,r=(l.sites,e.source);r.updateStore,r.articleList;a.selectSiteId=n;var i=t();for(var u in k.Jt.array.isEmpty(i.publishDate)||(i.beginTime=i.publishDate[0].format(M),i.endTime=i.publishDate[1].format(M)),delete i.publishDate,i)i[u]||delete i[u];return i},a.onSearch=function(){var e=a.props.source,t=e.updateStore,l=e.articleList,n=a.getFormData();n.pageNumber=1,t({query:n}),l(n)},a.onImportTypeChange=function(e){var t=a.props.source,l=t.updateStore,n=t.articleList,r=a.getFormData();r.importType=e,r.pageNumber=1,l({query:r}),n(r)},a.getColumns=function(){return[{title:"标题",dataIndex:"title"},{title:"来源",dataIndex:"importType",width:100,render:function(e){switch(e){case 0:return S.default.createElement("span",null,"手工导入");case 1:default:return S.default.createElement("span",null,"外部导入")}}},{title:"录入时间",width:200,dataIndex:"createAt"}]},a.state={selectedRowKeys:[]},a}return(0,v.default)(t,e),(0,h.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.cms.updateStore;e.cms.modalVisible!==this.props.cms.modalVisible&&t({modalVisible:e.cms.modalVisible})}},{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,l=t.source,f=l.loading,p=l.pagination,m=t.cms,h=m.updateStore,g=m.modalVisible,v=[].concat((0,s.default)(this.props.source.dataSource)),b={selectedRowKeys:this.state.selectedRowKeys,onChange:function(t,a){e.setState({selectedRowKeys:t}),h({selSouArts:a})},getCheckboxProps:function(e){return{disabeld:"Disabled User"===e.name,name:e.name}}};return S.default.createElement(n.default,{width:"1000px",visible:g,onCancel:this.handleModalCancel,footer:null},S.default.createElement(E.default,null,S.default.createElement(i.default,null,S.default.createElement(d.default,{span:5,style:{marginRight:"10px"}},S.default.createElement(D,(0,c.default)({label:"标题"},{labelCol:{span:6},wrapperCol:{span:18}}),a("title",{initialValue:""})(S.default.createElement(o.default,null)))),S.default.createElement(d.default,{span:4},S.default.createElement(D,(0,c.default)({label:"来源"},{labelCol:{span:6},wrapperCol:{span:18}}),a("importType",{initialValue:"",rules:[{message:"请输入"}]})(S.default.createElement(y.default,{placeholder:"please",onChange:this.onImportTypeChange},S.default.createElement(L,{value:""},"全部"),S.default.createElement(L,{value:"0"},"手工导入"),S.default.createElement(L,{value:"1"},"外部导入"))))),S.default.createElement(d.default,{span:12},S.default.createElement(D,(0,c.default)({label:"录入时间"},{labelCol:{span:5},wrapperCol:{span:18}}),a("publishDate",{initialValue:""})(S.default.createElement(x,{showTime:!0,format:M})))),S.default.createElement(d.default,{span:2},S.default.createElement(u.default,{type:"primary",style:{marginLeft:"10px",marginTop:"4px"},onClick:this.onSearch},"查询")))),S.default.createElement(r.default,{simple:!0,bordered:!0,columns:this.getColumns(),dataSource:v,rowSelection:b,rowKey:function(e){return e.id},loading:f,pagination:p,onChange:this.onPageChange}),S.default.createElement("div",{style:{marginTop:"20px"}},S.default.createElement(u.default,{type:"primary",onClick:this.handleModalOk,style:{marginRight:20}},"插入"),S.default.createElement(u.default,{type:"primary",onClick:this.handleModalCancel},"取消")))}}]),t}(C.Component))||l)||l)||l)||l;t.default=E.default.create()(T)},"2asT":function(e,t){},"3Z5y":function(e,t){},"44bM":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=T(a("82q9")),r=T(a("IidI")),i=T(a("uuhB")),u=T(a("0b0c")),d=T(a("G3dI")),o=T(a("Dd8w")),s=T(a("1cZb")),c=T(a("Zx67")),f=T(a("Zrlr")),p=T(a("wxAW")),m=T(a("zwoO")),h=T(a("Pf15")),g=T(a("NJOH")),v=T(a("PoSO")),y=T(a("37+n")),E=T(a("sRCy")),b=T(a("l2X+"));a("6ISc"),a("1uA9"),a("TZP0"),a("kxBb"),a("/Hhv"),a("YaoS"),a("mKHw"),a("BTAY"),a("8QNH"),a("ySR4"),a("GhWA");var C=a("GiK3"),S=T(C),w=T(a("PJh5")),k=a("Mn8c"),I=a("y986"),x=a("F8kA"),D=a("SFkB"),L=a("LkMq"),M=T(a("2M9t"));function T(e){return e&&e.__esModule?e:{default:e}}var _=b.default.Item,A=E.default.RangePicker,R=y.default.Item,P=v.default.Group,F=v.default.Button,N=g.default.Option,O="YYYY-MM-DD HH:mm:ss",B=(0,k.inject)("cms")(l=(0,k.inject)("app")(l=(0,k.inject)("source")(l=(0,k.observer)(l=function(e){function t(e){(0,f.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));return a.onCreateArt=function(){a.props.history.push(L.ROUTER_PATHS.ARTICLES_EDIT)},a.onDelFlagChg=function(e){var t=a.props,l=t.cms,n=l.query,r=l.updateStore,i=l.articleList,u=t.app.user,d=(0,I.toJS)(n);d.delFlag=e.target.value;var o=(0,I.toJS)(u.permissions)||[],c=void 0;2==e.target.value?c="cms:articles:audit":1==e.target.value?c="cms:articles:view":4==e.target.value?c="cms:articles:view":0==e.target.value||6==e.target.value?c="cms:articles:onoff":99==e.target.value&&(c="cms:articles:view");var f=o.findIndex(function(e,t){return new RegExp("^"+e).test(c)});if(d.pageNumber=1,r({query:d,selArts:[]}),-1===f)return r({dataSource:[]}),void s.default.error("您没有该权限");i(d)},a.getDelFlagTpl=function(){return S.default.createElement(P,{onChange:a.onDelFlagChg},L.CMS_STATUS.map(function(e,t){return S.default.createElement(F,{key:t,value:e.value},e.label)}))},a.onSearch=function(){var e=a.props,t=e.cms,l=t.query,n=t.updateStore,r=t.articleList,i=(0,e.form.getFieldsValue)();D.Jt.array.isEmpty(i.publishDate)||(i.beginTime=i.publishDate[0].format(O),i.endTime=i.publishDate[1].format(O)),delete i.publishDate;var u=(0,I.toJS)(l);for(var d in i=(0,o.default)({},u,i))i[d]||delete i[d];i.pageNumber=1,n({query:i}),r(i)},a.onReset=function(){var e=a.props,t=e.form,l=t.resetFields,n=(t.getFieldsValue,e.cms),r=n.updateStore,i=n.query,u=n.articleList;l();var d=(0,I.toJS)(i);delete d.title,delete d.publishDate,delete d.operateUser,delete d.beginTime,delete d.endTime,delete d.status,r({query:d}),u(d)},a.onBatchMenuClick=function(e){var t=e.key,l=a.props.cms,n=l.selArts,r=l.onOffArts,i=l.deleteArts,u=l.batchAuditArts;if("online"===t||"offline"===t){if(0===n.length)return void s.default.error("请选择文章");for(var d=[],o=[],c=0;c<n.length;c++)0===n[c].delFlag?o.push(n[c].id):d.push(n[c].id);if("online"===t&&o.length>0)return void s.default.error("选择的文章中包含上线文章");if("offline"===t&&d.length>0)return void s.default.error("选择的文章中包含下线文章");r((d.length>0?d:o).join(","))}else if("delete"===t){if(0===n.length)return void s.default.error("请选择文章");for(var f=[],p=0;p<n.length;p++)0!==n[p].delFlag&&f.push(n[p].id);if(f.length!==n.length)return void s.default.error("选择的文章中包含上线文章");i(f)}else if("audit"===t){if(0===n.length)return void s.default.error("请选择文章");for(var m=[],h=0;h<n.length;h++)m.push(n[h].id);u(m.join(","))}},a.getBatchMenu=function(){var e=a.props.cms.query.delFlag;return S.default.createElement(b.default,{onClick:a.onBatchMenuClick},(6==e||2==e)&&S.default.createElement(_,{key:"online"},"批量上线"),0==e&&S.default.createElement(_,{key:"offline"},"批量下线"),1==e&&S.default.createElement(_,{key:"audit"},"批量送审"),(6==e||1==e||4==e)&&S.default.createElement(_,{key:"delete"},"批量删除"))},a.showModal=function(){var e=a.props,t=e.source,l=e.app,n=l.selectSiteId,r=(l.sites,e.cms),i=(r.modalVisible,r.updateStore);a.selectSiteId=n,t.getInit({siteId:n}),i({modalVisible:!0})},a.handleModalCancel=function(){var e=a.props.cms;e.modalVisible;(0,e.updateStore)({modalVisible:!1})},a.onStatusChange=function(e){var t=a.props.cms,l=t.query,n=t.updateStore,r=t.articleList,i=l;i.pageNumber=1,i.status=e,n({query:i}),r(i)},a}return(0,h.default)(t,e),(0,p.default)(t,[{key:"render",value:function(){var e=this.props,t=e.cms,a=t.query,l=t.modalVisible,s=t.catTree,c=e.form.getFieldDecorator;return S.default.createElement("div",null,S.default.createElement(y.default,{style:{marginBottom:"15px"}},S.default.createElement(u.default,{gutter:8},S.default.createElement(d.default,{span:11},S.default.createElement(R,(0,o.default)({label:"录入时间"},{labelCol:{span:4},wrapperCol:{span:20}}),c("publishDate",{initialValue:a.beginTime?[(0,w.default)(a.beginTime,O),(0,w.default)(a.endTimes)]:null})(S.default.createElement(A,{showTime:!0,format:O})))),S.default.createElement(d.default,{span:12,push:1},S.default.createElement(R,null,c("delFlag",{initialValue:void 0!==a.delFlag?a.delFlag+"":"1"})(this.getDelFlagTpl())))),S.default.createElement(u.default,{gutter:8},S.default.createElement(d.default,{span:8},S.default.createElement(R,(0,o.default)({label:"稿件标题"},{labelCol:{span:6},wrapperCol:{span:18}}),c("title",{initialValue:a.title||""})(S.default.createElement(i.default,null)))),S.default.createElement(d.default,{span:8},S.default.createElement(R,(0,o.default)({label:"操作人"},{labelCol:{span:6},wrapperCol:{span:16}}),c("operateUser",{initialValue:a.operateUser||""})(S.default.createElement(i.default,null)))),"99"==a.delFlag&&S.default.createElement(d.default,{span:4},S.default.createElement(R,(0,o.default)({label:"状态"},{labelCol:{span:6},wrapperCol:{span:14}}),c("status",{initialValue:"99"})(S.default.createElement(g.default,{placeholder:"全部",onChange:this.onStatusChange},S.default.createElement(N,{value:"99"},"全部"),S.default.createElement(N,{value:"1"},"草稿"),S.default.createElement(N,{value:"2"},"待审核"),S.default.createElement(N,{value:"4"},"待修改"),S.default.createElement(N,{value:"0"},"已上线"),S.default.createElement(N,{value:"6"},"已下线"))))),S.default.createElement(d.default,{span:4},S.default.createElement(R,null,S.default.createElement(r.default,{type:"primary",onClick:this.onSearch},"查询"),S.default.createElement(r.default,{style:{marginLeft:"10px"},onClick:this.onReset},"重置")))),!!(0,I.toJS)(s).length&&"99"!==a.delFlag&&S.default.createElement(u.default,null,S.default.createElement(d.default,{span:18},S.default.createElement(n.default.Button,{overlay:this.getBatchMenu()},"批量操作")),!!(0,I.toJS)(s).length&&(0,I.toJS)(a).categoryId!=(0,I.toJS)(s)[0].id&&S.default.createElement(d.default,{span:3,style:{textAlign:"right"}},1==a.delFlag&&S.default.createElement("div",null,S.default.createElement(r.default,{type:"primary",onClick:this.showModal},"稿源库选稿"),S.default.createElement(M.default,{modalVisible:l,handleModalCancel:this.handleModalCancel}))),!!(0,I.toJS)(s).length&&(0,I.toJS)(a).categoryId!=(0,I.toJS)(s)[0].id&&S.default.createElement(d.default,{span:3,style:{textAlign:"right"}},1==a.delFlag&&S.default.createElement(r.default,{type:"primary",onClick:this.onCreateArt},"新建文章")))))}}]),t}(C.Component))||l)||l)||l)||l;t.default=(0,x.withRouter)(y.default.create()(B))},"74I+":function(e,t){},PG7Z:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n,r,i=J(a("vaID")),u=J(a("LoBt")),d=J(a("IidI")),o=J(a("1cZb")),s=J(a("sRCy")),c=J(a("0b0c")),f=J(a("G3dI")),p=J(a("Dd8w")),m=J(a("Zx67")),h=J(a("Zrlr")),g=J(a("wxAW")),v=J(a("zwoO")),y=J(a("Pf15")),E=J(a("kr0b")),b=J(a("uuhB")),C=J(a("VCGi")),S=J(a("NJOH")),w=J(a("37+n")),k=J(a("Q7hp")),I=J(a("Dc7M"));a("nclB"),a("/eDY"),a("1uA9"),a("YaoS"),a("ySR4"),a("kxBb"),a("/Hhv"),a("2xSi"),a("TZP0"),a("6opi"),a("mKHw"),a("8QNH");var x=a("GiK3"),D=J(x),L=a("F8kA"),M=a("Mn8c"),T=a("y986");a("23sO");var _=J(a("mw3O")),A=J(a("PJh5")),R=a("SFkB"),P=a("LkMq"),F=J(a("aWuq")),N=J(a("ssYj")),O=J(a("o2yl")),B=J(a("kvC3"));function J(e){return e&&e.__esModule?e:{default:e}}var V=w.default.Item,U=S.default.Option,z=C.default.Panel,Y=b.default.TextArea,q={labelCol:{span:7},wrapperCol:{span:17}},Z=(E.default.SHOW_PARENT,(0,M.inject)("app")(l=(0,M.inject)("cms")(l=(0,M.observer)((n=function(e){function t(e){(0,h.default)(this,t);var a=(0,v.default)(this,(t.__proto__||(0,m.default)(t)).call(this,e));r.call(a);var l=e.cms,n=e.history,i=(0,T.toJS)(l.query);a.state={tCategoryId:[],rejectModal:!1},i.delFlag||n.push(P.ROUTER_PATHS.ARTICLES);var u=e.location.search,d=e.cms,o=d.getArtItem,s=d.updateStore,c=d.getChannelItem,f=d.query,p=d.articleId,g=_.default.parse(u.substr(1));if(g.id)o(g.id),p&&c(p);else{var y=[];f.categoryId?y.push(f.categoryId+""):y.push("1"),s({curArt:{},channelList:y})}return a}return(0,y.default)(t,e),(0,g.default)(t,[{key:"setModalVisible",value:function(e){this.setState({rejectModal:e})}},{key:"componentWillUnmount",value:function(){var e=this.props.cms,t=e.updateStore;e.channelList;t({curArt:{},channelList:[]})}},{key:"componentWillReact",value:function(){var e=this.props.cms,t=e.curArt,a=e.query,l=e.channelList;l.categoryId&&[].push(l.categoryId+"");var n=void 0!==t.categoryId?t.categoryId+"":a.categoryId+""||"1";n!==this.state.tCategoryId&&this.setState({tCategoryId:n})}},{key:"render",value:function(){var e=this.props,t=e.cms,a=t.curArt,l=t.catTree,n=t.query,r=t.channelList,i=e.form,u=i.getFieldDecorator,d=(i.getFieldsValue,e.app),o={treeData:(0,T.toJS)(l),value:(0,T.toJS)(r),onChange:this.onTpropsChange,multiple:!0,searchPlaceholder:"请选择"};return D.default.createElement(w.default,{className:"article-edit"},D.default.createElement(c.default,null,D.default.createElement(f.default,{span:12},D.default.createElement(V,(0,p.default)({label:"肩标题"},{labelCol:{span:4},wrapperCol:{span:20}}),u("introTitle",{initialValue:a.introTitle})(D.default.createElement(b.default,{placeholder:"请输入肩标题"})))),D.default.createElement(f.default,{span:12},D.default.createElement(V,(0,p.default)({label:"列表标题"},{labelCol:{span:4},wrapperCol:{span:20}}),u("listTitle",{initialValue:a.listTitle})(D.default.createElement(b.default,{placeholder:"请输入列表标题"}))))),D.default.createElement(c.default,null,D.default.createElement(f.default,{span:12},D.default.createElement(V,(0,p.default)({label:"标题"},{labelCol:{span:4},wrapperCol:{span:20}}),u("title",{initialValue:a.title,rules:[{required:!0,message:"请输入标题"}]})(D.default.createElement(b.default,{placeholder:"请输入标题"})))),D.default.createElement(f.default,{span:12},D.default.createElement(V,(0,p.default)({label:"外部链接"},{labelCol:{span:4},wrapperCol:{span:20}}),u("link",{initialValue:a.link})(D.default.createElement(b.default,{placeholder:"请输入外部链接"}))))),D.default.createElement(c.default,null,D.default.createElement(f.default,{span:12},D.default.createElement(V,(0,p.default)({label:"副标题"},{labelCol:{span:4},wrapperCol:{span:20}}),u("subTitle",{initialValue:a.subTitle})(D.default.createElement(b.default,{placeholder:"请输入副标题"})))),D.default.createElement(f.default,{span:12},D.default.createElement(V,(0,p.default)({label:"发布到频道"},{labelCol:{span:4},wrapperCol:{span:20}}),D.default.createElement(E.default,(0,p.default)({showSearch:!0},o))))),D.default.createElement(c.default,null,D.default.createElement(f.default,{span:6},D.default.createElement(V,(0,p.default)({label:"作者"},{labelCol:{span:8},wrapperCol:{span:16}}),u("authors",{initialValue:a.authors})(D.default.createElement(b.default,{placeholder:"请输入作者"})))),D.default.createElement(f.default,{span:6},D.default.createElement(V,(0,p.default)({label:"责任编辑"},q),u("responsibleUser",{initialValue:a.responsibleUser||d.user.username||""})(D.default.createElement(b.default,{placeholder:"请输入责任编辑"})))),D.default.createElement(f.default,{span:6},D.default.createElement(V,(0,p.default)({label:"来源"},{labelCol:{span:8},wrapperCol:{span:16}}),u("source",{initialValue:a.source})(D.default.createElement(b.default,{placeholder:"请输入来源"})))),D.default.createElement(f.default,{span:6},D.default.createElement(V,(0,p.default)({label:"发布时间"},{labelCol:{span:8},wrapperCol:{span:16}}),u("publishDate",{initialValue:void 0!==a.publishDate?(0,A.default)(a.publishDate,"YYYY-MM-DD HH:mm:ss"):(0,A.default)((new Date).format("yyyy-MM-dd hh:mm:ss"))})(D.default.createElement(s.default,{style:{minWidth:"200px"},popupStyle:{zIndex:"9999"},showTime:!0,format:"YYYY-MM-DD HH:mm:ss"}))))),D.default.createElement(c.default,null,D.default.createElement(f.default,{span:6},D.default.createElement(V,(0,p.default)({label:"稿件类型"},{labelCol:{span:8},wrapperCol:{span:16}}),u("type",{initialValue:a.type||"common"})(D.default.createElement(S.default,{onChange:this.onTypeChg},P.TYPES.map(function(e){return D.default.createElement(U,{key:e.key,value:e.key},e.label)}))))),D.default.createElement(f.default,{span:12,style:{display:"none"}},D.default.createElement(V,(0,p.default)({label:"所属频道"},q),u("categoryId",{initialValue:void 0!==a.categoryId?a.categoryId+"":n.categoryId+""||"0"})(D.default.createElement(E.default,{showSearch:!0,treeNodeFilterProp:"label",treeData:(0,T.toJS)(l),onChange:this.onCategoryIdChange})))),D.default.createElement(f.default,{span:6},D.default.createElement(V,(0,p.default)({label:"文章同步到论坛"},{labelCol:{span:12},wrapperCol:{span:12}}),u("allowPost",{initialValue:void 0!==a.allowPost?a.allowPost+"":"0"})(D.default.createElement(S.default,null,D.default.createElement(U,{key:"1",value:"1"},"是"),D.default.createElement(U,{key:"2",value:"0"},"否"))))),"0"===n.delFlag?D.default.createElement(f.default,{span:12},D.default.createElement(V,(0,p.default)({label:"文章链接"},{labelCol:{span:4},wrapperCol:{span:20}}),D.default.createElement("a",{href:a.url},a.url))):""),D.default.createElement(c.default,null,D.default.createElement(f.default,{span:12},D.default.createElement(f.default,{span:24},D.default.createElement(V,(0,p.default)({label:"摘要"},{labelCol:{span:4},wrapperCol:{span:20}}),u("description",{initialValue:a.description})(D.default.createElement(Y,{autosize:{minRows:4,maxRows:6},placeholder:"请输入摘要"}))))),this.getRejectReason()),D.default.createElement(c.default,{type:"flex",justify:"center"},D.default.createElement(f.default,null,this.getStatusBtn())),D.default.createElement("div",null,n.delFlag?D.default.createElement(B.default,{ref:"ueditor",initialContent:(0,k.default)(a,"articleData.content")}):null),this.getThumbnailTpl(),this.getAlbumTpl(),this.getAudioTpl(),this.getVideoTpl())}}]),t}(x.Component),r=function(){var e=this;this.goBack=function(){e.props.history.goBack()},this.handleOnSave=function(t,a){var l=e.props,n=l.cms,r=n.onSaveDraft,i=n.onSaveChannel,u=n.curArt,d=n.query,s=n.onSaveAudit,c=n.onSave,f=n.albumNum,m=n.audioNum,h=n.videoNum,g=n.updateStore,v=n.channelList,y=l.form,E=y.validateFields,b=y.getFieldsValue,C=y.resetFields;E(function(l,n){if(!l){var y=(0,p.default)({categoryId:d.categoryId,articleData:(0,p.default)({},(0,I.default)(u.articleData,["audios","audioJson","videos","videoJson","images","imageJson"]))},(0,I.default)((0,T.toJS)(u),"articleData"),{delFlag:t},b());y.publishDate&&(y.publishDate=y.publishDate.format("YYYY-MM-DD HH:mm:ss")),y.thumbnail&&(y.imageUrl=e.fromThumbnail(y.thumbnail)),delete y.thumbnail,1===f?y.articleData.imageJson=e.fromAlbum(y.album):delete y.articleData.imageJson,delete y.album;var E=[];1===m?(y.audio.id?E.push(y.audio.id):y.audioUrl=y.audio.url,y.audioCover=y.audio.coverImg):(delete y.audioUrl,delete y.audioCover),delete y.audio,1===h?(y.video.id?E.push(y.video.id):y.videoUrl=y.video.url,y.videoCover=y.video.coverImg):(delete y.videoUrl,delete y.videoCover),delete y.video,y.mediaIds=E;var S=y.articleData.imageJson;if("image"===y.type&&S.length<1)return o.default.error("图集请至少上传一张图片"),!1;var w=(0,p.default)({},y);w.articleData.content=e.refs.ueditor.getContent();(0,T.toJS)(v);var k=function(){C(),e.goBack(),o.default.success("保存成功")};k=1===a?function(){C();var t=[];t.push(d.categoryId+""),g({curArt:{type:w.type},channelList:t}),e.refs.ueditor.setContent(""),o.default.success("保存成功")}:2===a?function(){g({curArt:w}),o.default.info("保存成功！")}:function(){C(),e.goBack(),o.default.success("保存成功")},i({list:(0,T.toJS)(v),article:w}),2==d.delFlag?s(w,k):1==d.delFlag||4==d.delFlag?r(w,k):c(w,k)}})},this.fromAlbum=function(e){var t=e.fileList,a=[];return(void 0===t?[]:t).forEach(function(e){e.url&&a.push({index:+e.key,image:e.url,description:e.dec,width:e.width,height:e.height})}),a},this.fromThumbnail=function(e){var t=e.fileList,a=void 0===t?[]:t;if(0===a.length)return"";var l=[];return a.forEach(function(e){l.push(e.url)}),l.join(",")},this.toThumbnail=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return{};var t=[];return e.split(",http").forEach(function(e,a){a>0&&(e="http"+e),t.push({uid:-(a+1),name:e,url:e})}),{fileList:t}},this.toAlbum=function(){var t=e.props.cms.curArt.articleData,a=(void 0===t?{}:t).imageJson||[];if(R.Jt.array.isEmpty(a))return{fileList:[]};var l=[];return a.forEach(function(e,t){l.push({key:t,url:e.image,dec:e.description,width:e.width,height:e.height})}),{fileList:l}},this.toMedia=function(t){var a=e.props.cms.curArt.articleData,l=void 0===a?{}:a,n="video"===t?l.videoJson:l.audioJson;if(R.Jt.array.isEmpty(n))return{id:"",url:"",coverImg:"",name:""};var r=n[0];return{id:r.id,url:r.resources[0].url,coverImg:r.image,name:r.title}},this.getAlbumTpl=function(){var t=e.props,a=t.cms,l=a.albumNum,n=(a.curArt,t.form.getFieldDecorator);return 0===l?null:D.default.createElement(C.default,{defaultActiveKey:["album"]},D.default.createElement(z,{key:"album",header:"图集"},D.default.createElement(V,null,n("album",{initialValue:e.toAlbum()})(D.default.createElement(N.default,null)))))},this.getAudioTpl=function(){var t=e.props,a=t.cms,l=a.audioNum,n=(a.curArt,t.form.getFieldDecorator);return 0===l?null:D.default.createElement(C.default,{defaultActiveKey:["audio"]},D.default.createElement(z,{key:"audio",header:"音频"},D.default.createElement(V,null,n("audio",{initialValue:e.toMedia("audio")})(D.default.createElement(O.default,{type:"audio"})))))},this.getVideoTpl=function(){var t=e.props,a=t.cms,l=a.videoNum,n=(a.curArt,t.form.getFieldDecorator);return 0===l?null:D.default.createElement(C.default,{defaultActiveKey:["video"]},D.default.createElement(z,{key:"video",header:"视频"},D.default.createElement(V,null,n("video",{initialValue:e.toMedia("video")})(D.default.createElement(O.default,{type:"video"})))))},this.getThumbnailTpl=function(){var t=e.props,a=t.cms.curArt,l=t.form.getFieldDecorator;return D.default.createElement(V,null,l("thumbnail",{initialValue:e.toThumbnail(a.imageUrl)})(D.default.createElement(F.default,{single:!0,tip:"上传缩略图"})))},this.onTypeChg=function(t){var a=e.props.cms,l=a.curArt;(0,a.updateStore)({albumNum:"image"===t?1:0,videoNum:"video"===t?1:0,audioNum:"audio"===t?1:0,curArt:(0,p.default)({},l,{type:t})})},this.onDelete=function(t){var a=e.props,l=a.cms.deleteArt,n=a.history;l(t,function(){n.push(P.ROUTER_PATHS.ARTICLES)})},this.onPreview=function(t){var a=e.props.cms.preview,l=window.open("","_blank");a(t,function(e){if(0==e.code){var t=e.data;t?l.location.href=t:(l.close(),o.default.error("该频道没有绑定详情模版"))}})},this.getStatusBtn=function(){var t=e.props,a=t.cms,l=a.query,n=a.curArt,r=t.form.getFieldDecorator;return 1==l.delFlag?D.default.createElement(c.default,{style:{marginTop:"5px"}},D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,1,2)},"暂存"),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,1,0)},"保存并返回"),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,1,1)},"继续录入"),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,2,0)},"提交审核"),n.id&&D.default.createElement(d.default,{type:"primary",style:{marginRight:"20px",marginBottom:"20px"},size:"default",onClick:e.onPreview.bind(e,n.id)},"预览"),n.id&&D.default.createElement(u.default,{title:"确定删除吗",onConfirm:function(){return e.onDelete(n.id)}},D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},size:"default"},"删除")),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},size:"default",onClick:e.goBack},"返回")):2==l.delFlag?D.default.createElement("div",null,D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,l.delFlag,2)},"暂存"),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.setModalVisible.bind(e,!0)},"驳回"),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,0,0)},"上线"),n.id&&D.default.createElement(d.default,{type:"primary",style:{marginRight:"20px",marginBottom:"20px"},size:"default",onClick:e.onPreview.bind(e,n.id)},"预览"),n.id&&D.default.createElement(u.default,{title:"确定删除吗",onConfirm:function(){return e.onDelete(n.id)}},D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},size:"default"},"删除")),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},size:"default",onClick:e.goBack},"返回"),D.default.createElement(i.default,{title:"驳回原因",visible:e.state.rejectModal,onOk:e.handleOnSave.bind(e,4,0),onCancel:e.setModalVisible.bind(e,!1),zIndex:"9999"},D.default.createElement(V,null,r("rejectReason",{initialValue:""})(D.default.createElement(Y,{rows:4}))))):4==l.delFlag?D.default.createElement("div",null,D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,4,2)},"暂存"),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,4,0)},"保存并返回"),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,2,0)},"提交审核"),n.id&&D.default.createElement(d.default,{type:"primary",style:{marginRight:"20px",marginBottom:"20px"},size:"default",onClick:e.onPreview.bind(e,n.id)},"预览"),n.id&&D.default.createElement(u.default,{title:"确定删除吗",onConfirm:function(){return e.onDelete(n.id)}},D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},size:"default"},"删除")),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},size:"default",onClick:e.goBack},"返回")):D.default.createElement("div",null,D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,l.delFlag,2)},"暂存"),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},type:"primary",size:"default",onClick:e.handleOnSave.bind(e,l.delFlag,0)},"保存并返回"),n.id&&D.default.createElement(d.default,{type:"primary",style:{marginRight:"20px",marginBottom:"20px"},size:"default",onClick:e.onPreview.bind(e,n.id)},"预览"),n.id&&0!=l.delFlag&&D.default.createElement(u.default,{title:"确定删除吗",onConfirm:function(){return e.onDelete(n.id)}},D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},size:"default"},"删除")),D.default.createElement(d.default,{style:{marginRight:"20px",marginBottom:"20px"},size:"default",onClick:e.goBack},"返回"))},this.getRejectReason=function(){var t=e.props,a=t.cms,l=a.query,n=a.curArt,r=t.form.getFieldDecorator;return 4==l.delFlag?D.default.createElement(f.default,{span:12},D.default.createElement(V,(0,p.default)({label:"驳回理由"},{labelCol:{span:4},wrapperCol:{span:20}}),r("rejectReason",{initialValue:n.rejectReason||""})(D.default.createElement(Y,{autosize:{minRows:4,maxRows:6},disabled:!0})))):""},this.onTpropsChange=function(t){(0,e.props.cms.updateStore)({channelList:t})},this.onCategoryIdChange=function(t){var a=e.props,l=(a.form.getFieldsValue,a.cms),n=l.channelList,r=l.updateStore,i=e.state.tCategoryId,u=n;if(i!==t){var d=u.indexOf(i);-1!==d&&u.splice(d,1),-1===u.indexOf(t)&&void 0!==t&&u.push(t),r({channelList:u}),e.setState({tCategoryId:t})}}},l=n))||l)||l)||l);t.default=(0,L.withRouter)(w.default.create()(Z))},SmnJ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=v(a("Zx67")),r=v(a("Zrlr")),i=v(a("wxAW")),u=v(a("zwoO")),d=v(a("Pf15")),o=a("GiK3"),s=v(o),c=a("Mn8c"),f=(a("y986"),a("F8kA")),p=a("LkMq"),m=v(a("YzrD")),h=v(a("PG7Z"));a("cZCw");var g=v(a("z4MD"));function v(e){return e&&e.__esModule?e:{default:e}}var y=(0,c.inject)("app")(l=(0,c.inject)("cms")(l=(0,c.observer)(l=function(e){function t(e){return(0,r.default)(this,t),(0,u.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,d.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return s.default.createElement("div",{className:"p-common"},s.default.createElement(f.Switch,null,s.default.createElement(f.Route,{exact:!0,path:p.ROUTER_PATHS.ARTICLES,component:m.default}),s.default.createElement(f.Route,{exact:!0,path:p.ROUTER_PATHS.ARTICLES_EDIT,component:h.default}),s.default.createElement(f.Route,{component:g.default})))}}]),t}(o.Component))||l)||l)||l;t.default=(0,f.withRouter)(y)},TUAy:function(e,t){},VY0i:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=D(a("vaID")),r=D(a("yF52")),i=D(a("uuhB")),u=D(a("vgHw")),d=D(a("IidI")),o=D(a("8Uiw")),s=D(a("1cZb")),c=D(a("Dd8w")),f=D(a("woOf")),p=D(a("Zx67")),m=D(a("Zrlr")),h=D(a("wxAW")),g=D(a("zwoO")),v=D(a("Pf15")),y=D(a("sRCy")),E=D(a("NJOH")),b=D(a("rpsp")),C=D(a("qB1w")),S=D(a("37+n"));a("nclB"),a("tNTX"),a("TZP0"),a("ZJow"),a("1uA9"),a("dcJ6"),a("YaoS"),a("ySR4"),a("mKHw"),a("Nmhe"),a("FV/t"),a("8QNH");var w=D(a("GiK3")),k=D(a("KSGD")),I=a("Mn8c"),x=(a("y986"),a("LkMq"));function D(e){return e&&e.__esModule?e:{default:e}}a("3Z5y");var L=S.default.Item,M=C.default.TabPane,T=b.default.Dragger,_=(E.default.Option,y.default.RangePicker),A={name:"file",multiple:!0,showUploadList:!1,action:x.urlPath.UPLOAD_FILES},R=[{title:"文件",dataIndex:"file",render:function(e,t,a){return{children:w.default.createElement("div",null,e.cover?w.default.createElement("img",{src:e.cover,className:"coverImg"}):"",w.default.createElement("h3",null,w.default.createElement("a",null," ",e.name)),w.default.createElement("br",null),w.default.createElement("span",null," ",e.autoName)),props:{}}}},{title:"大小",dataIndex:"size"},{title:"上传时间",dataIndex:"uploadTime",render:function(e,t,a){return e?new Date(e).format("yyyy-MM-dd hh:mm:ss"):""}}],P=(0,I.inject)("app")(l=(0,I.observer)(l=function(e){function t(e){(0,m.default)(this,t);var a=(0,g.default)(this,(t.__proto__||(0,p.default)(t)).call(this,e));return a.queryMediaList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=a.props.app.getMediaList,l=(0,f.default)({pageNumber:1,pageSize:x.PAGE_SIZE},e);t((0,c.default)({},l))},a.showModal=function(){a.setState({visible:!0}),(0,a.props.form.resetFields)(),a.queryMediaList({type:a.state.type})},a.handleOk=function(){a.setState({loading:!0});var e=a.props.app.mediaList.filter(function(e){return a.state.selectedRowKeys==e.id}),t=a.props.onChange;t&&t((0,f.default)({},{newMediaData:e})),a.setState({loading:!1,visible:!1})},a.handleCancel=function(){a.setState({visible:!1})},a.handleSearch=function(){var e=(0,a.props.form.getFieldsValue)();e.date&&0!==e.date.length&&(e.startTime=e.date[0].format("YYYY-MM-DD"),e.endTime=e.date[1].format("YYYY-MM-DD")),e.keyword||delete e.keyword,delete e.date,e.pageNumber=1,e.type=a.state.type,a.queryMediaList(e)},a.handleSelectTypeChange=function(e){a.setState({type:e}),a.queryMediaList({type:e})},a.onMideaSelectChange=function(e){a.setState({selectedRowKeys:e})},a.onUploaderChange=function(e){var t=e.file.status;"uploading"===t&&a.setState({uploadFileList:e.fileList}),"done"===t?s.default.success(e.file.name+" 上传成功."):"error"===t&&s.default.error(e.file.name+" 上传失败.")},a.state={selectedRowKeys:[],loading:!1,visible:!1,uploadFileList:[],type:e.type||"video"},a}return(0,v.default)(t,e),(0,h.default)(t,[{key:"componentWillReceiveProps",value:function(e){e.type!==this.props.type&&this.setState({type:this.props.type})}},{key:"render",value:function(){var e=this.state,t=e.type,a=e.selectedRowKeys,l=this.props.form.getFieldDecorator,s=this.props.app,f=s.mediaList,p=s.mediaListPagination,m=s.getMediaList,h={type:"radio",selectedRowKeys:a,onChange:this.onMideaSelectChange},g={dataSource:f.map(function(e,t){return{key:e.id,file:{cover:e.cover||"",name:e.name,autoName:e.autoName,hdUrl:e.hdUrl},size:e.hdSize,uploadTime:e.uploadTime,id:e.id}}),pagination:p,onChange:function(e){m({type:t,pageNumber:e.current,pageSize:e.pageSize})}},v=this.state.uploadFileList.map(function(e,t){return w.default.createElement("div",{className:"progressWarp",key:e.uid},"上传文件“",e.name,"” ",w.default.createElement(o.default,{percent:e.percent}))});return w.default.createElement("span",null,w.default.createElement(d.default,{type:"primary",icon:"appstore-o",onClick:this.showModal},"选择媒体文件"),w.default.createElement(n.default,{wrapClassName:"media-modal-wrap",visible:this.state.visible,title:"选择媒体文件",width:"90%",zIndex:"9999",onOk:this.handleOk,onCancel:this.handleCancel,footer:[w.default.createElement(d.default,{key:"back",onClick:this.handleCancel},"取消"),w.default.createElement(d.default,{key:"submit",type:"primary",loading:this.state.loading,onClick:this.handleOk},"确定 ")]},w.default.createElement(C.default,{type:"card",defaultActiveKey:"2"},w.default.createElement(M,{tab:"上传文件",key:"1"},w.default.createElement(T,(0,c.default)({},A,{accept:"audio"==t?"audio/mp3":"video/mp4",onChange:this.onUploaderChange,className:"draggerWarper"}),w.default.createElement("div",{className:"draggerWarp"},w.default.createElement("p",{className:"ant-upload-drag-icon"},w.default.createElement(u.default,{type:"inbox"})),w.default.createElement("p",{className:"ant-upload-text"},"拖拽到此处上传"),w.default.createElement("p",{className:"ant-upload-hint"},"支持拖拽一个或多个文件上传, 仅支持","audio"==t?"mp3":"mp4","格式文件"))),v),w.default.createElement(M,{tab:"媒体库",key:"2"},w.default.createElement("div",null,w.default.createElement(S.default,{layout:"inline"},w.default.createElement(L,null,l("date",{initialValue:null})(w.default.createElement(_,{format:"YYYY-MM-DD"}))),w.default.createElement(L,null,l("keyword",{initialValue:""})(w.default.createElement(i.default,{placeholder:"关键词",style:{width:200}}))),w.default.createElement(L,null,w.default.createElement(d.default,{type:"primary",icon:"search",onClick:this.handleSearch})))),w.default.createElement("div",{style:{marginTop:10}},w.default.createElement(r.default,(0,c.default)({rowSelection:h,columns:R},g)))))))}}]),t}(w.default.Component))||l)||l;P.propTypes={value:k.default.object,onChange:k.default.func},t.default=S.default.create()(P)},YzrD:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=L(a("yF52")),r=L(a("Gu7T")),i=L(a("Dd8w")),u=L(a("LoBt")),d=L(a("1cZb")),o=L(a("Zx67")),s=L(a("Zrlr")),c=L(a("wxAW")),f=L(a("zwoO")),p=L(a("Pf15")),m=L(a("09Ma")),h=L(a("hIkJ")),g=L(a("kbi+"));a("tNTX"),a("/eDY"),a("YaoS"),a("c686");var v=a("GiK3"),y=L(v),E=L(a("O27J")),b=a("Mn8c"),C=a("y986"),S=(a("F8kA"),L(a("Lokx"))),w=L(a("mw3O")),k=a("LkMq"),I=L(a("44bM")),x=L(a("e78j")),D=a("SFkB");function L(e){return e&&e.__esModule?e:{default:e}}var M=m.default.TreeNode,T=(0,b.inject)("app")(l=(0,b.inject)("cms")(l=(0,b.observer)(l=function(e){function t(e){(0,s.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));a.renderTreeNode=function(e){return e.map(function(e,t){return y.default.createElement(M,{title:e.name,key:e.key},e.children&&a.renderTreeNode(e.children))})},a.onPreview=function(e){var t=a.props.cms.preview,l=window.open("","_blank");t(e,function(e){if(0==e.code){var t=e.data;t?l.location.href=t:(l.close(),d.default.error("该频道没有绑定详情模版"))}})},a.getColumns=function(){var e=a.props.cms.query,t=[{title:"标题",key:"title",dataIndex:"title",width:300,render:function(t,l){return"99"===e.delFlag?y.default.createElement("span",null,t):y.default.createElement("a",{onClick:a.onEdit.bind(a,l.id,l.articleId)},t)}},{title:"类型",key:"type",dataIndex:"type",width:60,render:function(e,t){switch(e){case"common":return"新闻";case"video":return"视频";case"audio":return"音频";case"image":return"图集";default:return""}}},{title:"录入时间",key:"createAt",dataIndex:"createAt",width:150},{title:"发布时间",key:"publishDate",dataIndex:"publishDate",width:150}];return"99"==e.delFlag&&t.push({title:"状态",key:"status",dataIndex:"delFlag",width:100,render:function(e,t){return 1==e?"草稿":2==e?"待审核":4==e?"待修改":0==e?"已上线":6==e?"已下线":99==e?"全部":void 0}}),t.concat([{title:"操作人",key:"operator",dataIndex:"operator",width:120,render:function(e,t){var a=[];return t.createUser&&a.push(y.default.createElement("div",{key:"ope-1"},"录入人：",t.createUser)),t.auditUser&&a.push(y.default.createElement("div",{key:"ope-2"},"审核人：",t.auditUser)),a}},{title:"操作",width:120,className:"action",render:function(t,l){var n=l.id,r=[y.default.createElement(x.default,{key:"action-1",permis:"cms:articles:edit"},y.default.createElement("a",{key:"action-1",onClick:a.onEdit.bind(a,n,l.articleId),style:{marginRight:"5px"}},"编辑"))];return 0!=e.delFlag&&"99"!==e.delFlag&&r.push(y.default.createElement(x.default,{key:"action-2",permis:"cms:articles:delete"},y.default.createElement(u.default,{title:"确定删除吗",onConfirm:a.onDelete.bind(a,n)},y.default.createElement("a",{style:{marginRight:"5px"}},"删除")))),0==e.delFlag?r.push([y.default.createElement(x.default,{key:"action-3",permis:"cms:articles:onoff"},y.default.createElement("a",{style:{marginRight:"5px"},onClick:a.offLine.bind(a,n,6)},"下线"))]):2==e.delFlag?r.push(y.default.createElement(x.default,{key:"action-6",permis:"cms:articles:onoff"},y.default.createElement("a",{style:{marginRight:"5px"},onClick:a.handleOnSave.bind(a,n,0)},"上线"))):6==e.delFlag?r.push(y.default.createElement(x.default,{key:"action-9",permis:"cms:articles:onoff"},y.default.createElement("a",{style:{marginRight:"5px"},onClick:a.handleOnSave.bind(a,n,0)},"上线"))):"99"===e.delFlag&&(r=[]),r.push(y.default.createElement("a",{key:"action-preview",style:{marginRight:"5px"},onClick:a.onPreview.bind(a,n)},"预览")),r}}])},a.onEdit=function(e,t){var l=a.props,n=l.history;(0,l.cms.updateStore)({articleId:t}),n.push({pathname:k.ROUTER_PATHS.ARTICLES_EDIT,search:"?"+w.default.stringify({id:e})})},a.onDelete=function(e){var t=a.props.cms,l=t.deleteArt,n=(t.articleList,t.getInit),r=t.query;l(e,function(){var e=(0,C.toJS)(r);n(e)})},a.handleOnSave=function(e,t){var l=a.props.cms,n=l.getArtItem;l.loading;n(e,function(){var l=a.props.cms,n=l.curArt,r=l.onSaveAudit,u=l.dataSource,d=(l.articleList,l.getInit),o=l.query,s=(0,C.toJS)(u);r((0,i.default)({articleData:(0,C.toJS)(n).articleData},s.find(function(t){return t.id===e}),{delFlag:t}),function(){var e=(0,C.toJS)(o);d(e)})})},a.offLine=function(e){var t=a.props.cms,l=t.getInit,n=t.onOffArt,r=t.query;n(e,function(){var e=(0,C.toJS)(r);l(e)})},a.onExpandChange=function(e,t){var l=t.node,n=t.expanded,r=a.props.cms,i=r.updateStore,u=r.catTree;if(!n){var d=l.props.eventKey,o=D.Jt.tree.getAllChildren((0,C.toJS)(u),d);o.length&&o.forEach(function(t,a){-1!==(0,h.default)(e,t)&&e.splice((0,h.default)(e,t),1)})}i({expandedKeys:e})},a.onSelect=function(e){var t=a.props.cms,l=t.articleList,n=t.updateStore,r=t.query,i=(0,C.toJS)(r);0!==e.length&&(i.categoryId=e[0],i.pageNumber=1,l(i),n({query:i}))},a.onPageChange=function(e){var t=a.props.cms,l=t.articleList,n=t.query;l((0,i.default)({},n,{pageNumber:e.current,pageSize:e.pageSize}))};var l=e.cms,n=e.app,r=n.selectSiteId,c=n.sites;return a.selectSiteId=r,a.selectSiteName=(0,g.default)(c,{id:r})?(0,g.default)(c,{id:r}).name:"",l.updateStore({selectSiteName:a.selectSiteName,siteId:r}),l.getInit({siteId:r}),a}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentWillReact",value:function(){var e=this.props,t=e.app,a=t.selectSiteId,l=t.sites,n=e.cms,r=n.query,i=n.getInit,u=n.updateStore;this.selectSiteId!=a&&(delete r.categoryId,i({siteId:a}),this.selectSiteName=(0,g.default)(l,{id:a})?(0,g.default)(l,{id:a}).name:"",u({selectSiteName:this.selectSiteName,siteId:a})),this.selectSiteId=a}},{key:"componentDidMount",value:function(){var e=this,t=E.default.findDOMNode(this.refs.table).querySelector(".ant-table-tbody");this.sortable=new S.default(t,{draggable:".ant-table-row",onEnd:function(t){var a=t.oldIndex,l=t.newIndex;if(a!==l){var n=a,i=l;a>l&&(n=l,i=a);var u=e.props.cms,d=u.dataSource,o=u.updateStore,s=u.updateSorts,c=(0,C.toJS)(d),f=c[l],p=c.splice(a,1)[0];p.stick=f.stick,c.splice(l,0,p);for(var m=c.slice(n,i+1),h=[],g=[],v=0,y=m.length;v<y;v++)h.push(m[v].id),g.push(m[v].weight);g.sort(function(e,t){return t-e});for(var E=0,b=m.length;E<b;E++)m[E].weight=g[E];for(var S=[],w=0,k=h.length;w<k;w++)S.push({id:h[w],weight:g[w]});c.splice.apply(c,[n,m.length].concat((0,r.default)(m))),o({dataSource:c}),s(S)}}})}},{key:"componentWillUnmount",value:function(){this.sortable.destroy()}},{key:"render",value:function(){var e=this.props,t=e.cms,a=t.catTree,l=t.expandedKeys,r=t.selArts,i=t.updateStore,u=t.query,d=t.dataSource,o=t.loading,s=t.pagination,c=(e.app.selectSiteId,(0,C.toJS)(a)),f={selectedRowKeys:(0,C.toJS)(r).map(function(e){return e.id}),onChange:function(e,t){i({selArts:t})}};return y.default.createElement("div",{className:"cms-wrap"},y.default.createElement("div",{className:"cat-tree"},y.default.createElement(m.default,{selectedKeys:[""+(0,C.toJS)(u.categoryId)||"1"],expandedKeys:(0,C.toJS)(l),onExpand:this.onExpandChange,onSelect:this.onSelect,defaultExpandedKeys:["1"]},this.renderTreeNode(c))),y.default.createElement("div",{className:"cms-list"},y.default.createElement(I.default,null),y.default.createElement(n.default,{ref:"table",className:"draggable-table",simple:!0,bordered:!0,columns:this.getColumns(),dataSource:(0,C.toJS)(d),loading:o,rowKey:function(e){return e.id},pagination:s,onChange:this.onPageChange,rowSelection:"99"===u.delFlag?null:f})))}}]),t}(v.Component))||l)||l)||l;t.default=T},aWuq:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=h(a("vaID")),n=h(a("rpsp")),r=h(a("vgHw")),i=h(a("pFYg")),u=h(a("1cZb")),d=h(a("Zx67")),o=h(a("Zrlr")),s=h(a("wxAW")),c=h(a("zwoO")),f=h(a("Pf15"));a("nclB"),a("Nmhe"),a("ZJow"),a("YaoS");var p=h(a("GiK3")),m=a("LkMq");function h(e){return e&&e.__esModule?e:{default:e}}a("TUAy");var g=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));a.imgSave=function(e,t){var l=a.state.fileList;l[e].url=t,a.setState({fileList:l,previewVisible:!1})},a.handlePreview=function(e){a.setState({previewImage:e.url,previewVisible:!0,previewIndex:e.index})},a.handleChange=function(e){var t=e.file,l=e.fileList;"error"==t.status?l=a.state.fileList:t.response&&0!==t.response.code?(u.default.error(t.response.msg),l=l.filter(function(e){return e.uid!==t.uid})):(a.props.single&&(l=l.slice(-1)),l=(l=l.map(function(e,t){return e.response&&0===e.response.code&&e.response.data&&(e={name:e.name,url:e.response.data.fileUrl,uid:e.uid,index:t}),e})).filter(function(e){return!e.response||0===e.response.code})),a.setState({fileList:l});var n=a.props.onChange;(n&&"done"==t.status||"removed"==t.status)&&n({fileList:l})},a.handleCancel=function(){a.setState({previewVisible:!1})};var l=a.props,n=l.accept,r=l.value,s=void 0===r?{}:r;return s.fileList&&s.fileList.map(function(e,t){void 0===(0,i.default)(e.uid)&&(e.uid=-(t+1)),e.index=t}),n||(n=[],m.IMG_UPLOAD_TYEPS.forEach(function(e){n.push("image/"+e)}),n=n.join(",")),a.state={accept:n,previewVisible:!1,previewImage:"",fileList:s.fileList||[]},a}return(0,f.default)(t,e),(0,s.default)(t,[{key:"componentWillReceiveProps",value:function(e){if("value"in e&&e.value){var t=e.value;t.fileList&&t.fileList.map(function(e,t){e.index=t});var a={fileList:t.fileList||[]};this.setState(a)}}},{key:"render",value:function(){var e=this.state,t=e.accept,a=e.previewVisible,i=e.previewImage,u=(e.previewIndex,e.fileList),d=this.props,o=(d.width,d.height,d.ratio,p.default.createElement("div",null,p.default.createElement(r.default,{type:"plus"}),p.default.createElement("div",{className:"ant-upload-text"},this.props.tip||"上传")));return p.default.createElement("div",{className:"clearfix"},p.default.createElement(n.default,{accept:t,action:m.urlPath.UPLOAD_FILE,listType:"picture-card",fileList:u,onPreview:this.handlePreview,onChange:this.handleChange,multiple:!this.props.single,className:"img-uploader"},this.props.single&&u.length>=1?null:o),p.default.createElement(l.default,{title:"图片预览",width:640,visible:a,footer:null,onCancel:this.handleCancel,zIndex:"9999"},p.default.createElement("img",{alt:"example",style:{width:"100%"},src:i})))}}]),t}(p.default.Component);t.default=g},cZCw:function(e,t){},e78j:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,n=p(a("Zx67")),r=p(a("Zrlr")),i=p(a("wxAW")),u=p(a("zwoO")),d=p(a("Pf15")),o=a("GiK3"),s=p(o),c=a("Mn8c"),f=a("y986");function p(e){return e&&e.__esModule?e:{default:e}}var m=(0,c.inject)("app")(l=(0,c.observer)(l=function(e){function t(e){return(0,r.default)(this,t),(0,u.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,d.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.children,a=e.app.user,l=e.permis;return((0,f.toJS)(a.permissions)||[]).findIndex(function(e,t){return new RegExp("^"+e).test(l)})>=0?s.default.createElement("span",null,t):null}}]),t}(o.Component))||l)||l;t.default=m},o2yl:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=E(a("rpsp")),n=E(a("vgHw")),r=E(a("woOf")),i=E(a("Dd8w")),u=E(a("Zx67")),d=E(a("Zrlr")),o=E(a("wxAW")),s=E(a("zwoO")),c=E(a("Pf15")),f=E(a("uuhB")),p=E(a("qB1w"));a("Nmhe"),a("ZJow"),a("TZP0"),a("FV/t");var m=E(a("GiK3")),h=E(a("KSGD")),g=a("LkMq");a("p/XX");var v=E(a("VY0i")),y=E(a("qcnf"));function E(e){return e&&e.__esModule?e:{default:e}}var b=p.default.TabPane,C=(f.default.Group,function(e){function t(e){(0,d.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));a.onCoverChange=function(e){var t=a.state.coverImg;"done"==e.file.status&&e.file.response&&0==e.file.response.code&&e.file.response.data&&(t=e.file.response.data.fileUrl),a.setState({coverImg:t}),a.triggerChange({coverImg:t})},a.onUrlChange=function(e){var t=e.target.value;a.setState({url:t,id:""}),a.triggerChange({url:t,id:""})},a.onMediaChange=function(e){if(e&&e.newMediaData&&e.newMediaData.length>0){var t=e.newMediaData[0],l={type:t.type,id:t.id,coverImg:t.cover||a.state.coverImg||"",url:t.hdUrl||t.mp3BigUrl,name:t.name};a.setState((0,i.default)({},l)),a.triggerChange((0,i.default)({},l))}},a.triggerChange=function(e){var t=a.props.onChange;if(t){var l=a.state,n=l.coverImg,i=l.url,u=l.id;t((0,r.default)({},{coverImg:n,url:i,id:u},e))}};var l=e.value||{coverImg:"",url:"",id:""};return a.state=(0,i.default)({},l,{type:a.props.type||"video"}),a}return(0,c.default)(t,e),(0,o.default)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.value;this.setState((0,i.default)({},t))}},{key:"render",value:function(){var e=this,t=this.state,a=t.id,r=t.type,i=t.url,u=t.coverImg,d={type:r,name:t.name,url:i,onDelete:function(){e.triggerChange({id:"",name:"",url:"",coverImg:""})}};return m.default.createElement("div",null,m.default.createElement(p.default,{defaultActiveKey:i&&!a?"2":"1",className:"tabCon"},m.default.createElement(b,{tab:m.default.createElement("span",null,m.default.createElement(n.default,{type:"appstore-o"}),"从媒体库选择"),key:"1"},m.default.createElement(v.default,{type:r,onChange:this.onMediaChange}),m.default.createElement(y.default,d)),m.default.createElement(b,{tab:m.default.createElement("span",null,m.default.createElement(n.default,{type:"link"}),"输入文件地址"),key:"2"},m.default.createElement(f.default,{style:{width:"80%"},value:i,placeholder:"请输入文件地址",onChange:this.onUrlChange}),m.default.createElement("span",{className:"mediaPlayer"},m.default.createElement(y.default,d)))),m.default.createElement(l.default,{className:"cover-uploader",name:"file",showUploadList:!1,action:g.urlPath.UPLOAD_FILE,onChange:function(t){return e.onCoverChange(t)}},u?m.default.createElement("img",{src:u,alt:"",className:"cover-img"}):m.default.createElement(n.default,{type:"plus",className:"cover-uploader-trigger"})),m.default.createElement("div",{className:"decWarper"},m.default.createElement("span",null,"封面图片")))}}]),t}(m.default.Component));C.propTypes={value:h.default.object},t.default=C},"p/XX":function(e,t){},qcnf:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=m(a("vaID")),n=m(a("vgHw")),r=m(a("Dd8w")),i=m(a("Zx67")),u=m(a("Zrlr")),d=m(a("wxAW")),o=m(a("zwoO")),s=m(a("Pf15")),c=m(a("Dc7M"));a("nclB"),a("ZJow");var f=m(a("GiK3")),p=m(a("KSGD"));function m(e){return e&&e.__esModule?e:{default:e}}a("2asT");var h=function(e){function t(e){(0,u.default)(this,t);var a=(0,o.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleClose=function(){var e=a.state.type,t=a.refs[e];t&&t.pause(),a.setState({visible:!1})},a.onOk=function(){a.handleClose()},a.onCancel=function(){a.handleClose()},a.showMediaPlayerModal=function(){a.setState({visible:!0})},a.state={visible:e.visible||!1,type:e.type||"video",name:e.name||"",url:e.url||""},a}return(0,s.default)(t,e),(0,d.default)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState((0,r.default)({},(0,c.default)(e,["onDelete"])))}},{key:"render",value:function(){var e=this.state,t=e.type,a=e.name,i=e.url,u=e.visible,d=this.props.onDelete,o={visible:u,title:"预览",onOk:this.onOk,onCancel:this.onCancel,zIndex:"9999"};return f.default.createElement("span",null,f.default.createElement("span",{style:{marginLeft:10}},a),f.default.createElement("a",{onClick:this.showMediaPlayerModal,style:{marginLeft:10}},"预览"),i?f.default.createElement("a",{onClick:d,style:{marginLeft:10,fontSize:16}},f.default.createElement(n.default,{type:"delete"})):void 0,f.default.createElement(l.default,(0,r.default)({},o,{className:"mediaPlayer"}),"video"===t?f.default.createElement("video",{ref:"video",src:i,controls:!0},"浏览器版本过低，不支持video"):f.default.createElement("audio",{ref:"audio",src:i,controls:!0},"浏览器版本过低，不支持audio")))}}]),t}(f.default.Component);h.propTypes={type:p.default.string,visible:p.default.bool,url:p.default.string},t.default=h},ssYj:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=C(a("vaID")),n=C(a("IidI")),r=C(a("0b0c")),i=C(a("ExGt")),u=C(a("uuhB")),d=C(a("G3dI")),o=C(a("vgHw")),s=C(a("1cZb")),c=C(a("Dd8w")),f=C(a("Zx67")),p=C(a("Zrlr")),m=C(a("wxAW")),h=C(a("zwoO")),g=C(a("Pf15")),v=C(a("rpsp")),y=C(a("37+n"));a("nclB"),a("1uA9"),a("kxBb"),a("2r77"),a("TZP0"),a("/Hhv"),a("ZJow"),a("YaoS"),a("Nmhe"),a("8QNH");var E=C(a("GiK3")),b=a("LkMq");function C(e){return e&&e.__esModule?e:{default:e}}a("74I+");y.default.Item;var S=v.default.Dragger,w=function(e){function t(e){(0,p.default)(this,t);var a=(0,h.default)(this,(t.__proto__||(0,f.default)(t)).call(this,e)),l=a.props,n=l.accept,r=l.value,i=void 0===r?{}:r;return n||(n=[],b.IMG_UPLOAD_TYEPS.forEach(function(e){n.push("image/"+e)}),n=n.join(",")),a.state={accept:n,bamv:!1,fileList:i.fileList||[]},a}return(0,g.default)(t,e),(0,m.default)(t,[{key:"componentWillReceiveProps",value:function(e){if(e.value){var t=e.value.fileList||[];this.setState({fileList:t})}}},{key:"remove",value:function(e){var t=this.state.fileList.filter(function(t){return t.key!==e});this.setState({fileList:t}),this.triggerChange({fileList:t})}},{key:"add",value:function(){var e=this.state.fileList;e.map(function(e,t){e.key=t}),e.push({key:e.length,url:"",dec:""}),this.setState({fileList:e}),this.triggerChange({fileList:e})}},{key:"batchAdd",value:function(){var e=this.state.fileList,t=this.batchList||[],a=e.length;t.forEach(function(t,l){e.push({key:a+l,url:t.fileUrl,width:t.width,height:t.height,dec:""})}),this.setState({fileList:e}),this.triggerChange({fileList:e}),this.hideBam()}},{key:"showBam",value:function(){this.setState({bamv:!0})}},{key:"hideBam",value:function(){this.setState({bamv:!1})}},{key:"move",value:function(e,t){var a=this.state.fileList;if(!("up"==t&&0==e||"down"==t&&e==a.length-1)){"up"==t&&(e-=1);for(var l=0,n=a.length;l<n;l++)if(a[l].key==e){var r=(0,c.default)({},a[l]),i=(0,c.default)({},a[l+1]);a[l]=(0,c.default)({},i,{key:r.key}),a[l+1]=(0,c.default)({},r,{key:i.key});break}this.setState({fileList:a}),this.triggerChange({fileList:a})}}},{key:"handleUploadChange",value:function(e,t){var a=this.state.fileList,l=e.file;if("done"===l.status)if(l.response&&-1==l.response.code)s.default.error(l.response.msg);else if(l.response&&0==l.response.code&&l.response.data){var n=e.file.response.data,r=n.fileUrl,i=n.width,u=n.height;a.map(function(e){e.key==t&&(e.url=r,e.width=i,e.height=u)})}this.setState({fileList:a}),this.triggerChange({fileList:a})}},{key:"handleBatchUploadChange",value:function(e){var t=[];e.fileList.forEach(function(e){if("done"===e.status)if(e.response&&e.response.code<0)s.default.error(e.response.msg);else{var a=e.response.data,l=a.fileUrl,n=a.width,r=a.height;t.push({fileUrl:l,width:n,height:r})}}),this.batchList=t}},{key:"handleInputChange",value:function(e,t){var a=e.target.value,l=this.state.fileList;l.map(function(e){e.key==t&&(e.dec=a)}),this.setState({fileList:l}),this.triggerChange({fileList:l})}},{key:"triggerChange",value:function(e){var t=this.props.onChange;t&&t((0,c.default)({},this.state,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.fileList,s=t.bamv,f=t.accept,p=a.map(function(t,l){var n=t.url;return E.default.createElement("div",{key:t.key,className:"album-item"},E.default.createElement(r.default,{type:"flex",justify:"space-between",align:"top"},E.default.createElement(d.default,{span:3},E.default.createElement(v.default,{className:"album-uploader",name:"file",accept:f,showUploadList:!1,action:b.urlPath.UPLOAD_FILE,onChange:function(a){return e.handleUploadChange(a,t.key)}},n?E.default.createElement("div",{className:"album-image-wrap"},E.default.createElement("img",{src:n,className:"album-img"})):E.default.createElement(o.default,{type:"plus",className:"album-uploader-trigger"}))),E.default.createElement(d.default,{span:18},E.default.createElement(u.default,{type:"textarea",rows:5,value:t.dec,onChange:function(a){return e.handleInputChange(a,t.key)}})),E.default.createElement(d.default,{span:3},E.default.createElement(i.default,{title:"删除",placement:"top"},E.default.createElement(o.default,{className:"del-btn",type:"minus-circle-o",disabled:1===a.length,onClick:function(){return e.remove(t.key)}})),E.default.createElement(i.default,{title:"向上移动",placement:"top"},E.default.createElement(o.default,{type:"up-circle-o",disabled:0==l,onClick:function(){return e.move(t.key,"up")}})),E.default.createElement(i.default,{title:"向下移动",placement:"top"},E.default.createElement(o.default,{type:"down-circle-o",disabled:l==a.length-1,onClick:function(){return e.move(t.key,"down")}})))))}),m={visible:s,title:"批量添加",onCancel:this.hideBam.bind(this),onOk:this.batchAdd.bind(this)};return E.default.createElement("div",{className:"m-album"},p,E.default.createElement("div",null,E.default.createElement(n.default,{type:"dashed",onClick:this.add.bind(this)},E.default.createElement(o.default,{type:"plus"})," 添加一项"),E.default.createElement(n.default,{type:"dashed",className:"batch-add-btn",onClick:this.showBam.bind(this)},E.default.createElement(o.default,{type:"plus"})," 批量添加")),E.default.createElement(l.default,(0,c.default)({},m,{className:"batch-upload-modal"}),E.default.createElement("div",{className:"drag-wrap"},E.default.createElement(S,{accept:f,multiple:!0,showUploadList:!0,action:b.urlPath.UPLOAD_FILE,onChange:this.handleBatchUploadChange.bind(this)},E.default.createElement("p",{className:"ant-upload-drag-icon"},E.default.createElement(o.default,{type:"inbox"}))))))}}]),t}(E.default.Component);t.default=w}});